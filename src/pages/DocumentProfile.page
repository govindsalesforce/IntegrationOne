<!-- 
v1.0    Qualityze Inc(ST)      29-JUL-2016      Initial Version.
This class contains all Document Profile related code.
v1.1    Qualityze Inc(ST)      19-AUG-2016      for chronology
v1.2    Qualityze Inc(BK)      22-AUG-2016      for DocumentDetails
v1.3    Qualityze Inc(BK)      23-AUG-2016      for DocumentDetails
v1.4    Qualityze Inc(BK)      25-AUG-2016      for Change field on menu
v1.5    Qualityze Inc(ST)      09-SEP-2016      for DetailsPrint
v1.6    Qualityze Inc(GP)      17-SEP-2016      To fix issue :00972
                                                Edit functionality:Content section should not be editable
                                                When user clikc on edit from header theContent section should not be editable when Document status is Approved, Complete, Prerelease and Current
                                                
                                                Removed isEdit currentPage parameter from readOnly attribute for DocumentDetailsComponent
v1.7    Qualityze Inc(BK)      21-SEP-2016      Approval 
-->

<apex:page standardController="Document_Profile__c" extensions="DocumentProfileControllerExt,Approvalclass,QC_custom_settings" sidebar="false" showHeader="false" standardStylesheets="false" docType="html-5.0" readOnly="true">
    <div id="overlay" style="background-color: rgba(0, 0, 0, 0.15);z-index: 999;position: absolute;left: 0;top: 0;width: 100%;height: 200%;"></div>
    <div id="loading" style="height: 64px;width: 64px;align:center; position: absolute;margin: -100px 0 0 -200px;top: 80%;left: 50%;z-index:1000">
        <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i> <span class="sr-only">Loading...</span>
        
    </div>
    <script type="text/javascript">
    
    $( document ).ready(function() {
        setTimeout(show(), 1000);
        
        
    }); 
    
    
    function show(){
        $("#loading").hide();
        $("#overlay").hide();
    }
    
    
    
    //==== added by satish=====
    function changerequest(){
      var typename='{!documentprofile.type__c}';
      var numberval='{!documentprofile.Name}';
      console.log('type value is '+typename);
      console.log('numberval  is '+numberval);
      
        
        var url='/apex/changemanagement?dpid={!JSENCODE($CurrentPage.parameters.id)}&dpty='+typename+'&dpname='+numberval; 
        
        window.open(url,'_blank');
        
        
    }
    
    //===== added by satish end ======
    
    // ===Function added by Gaurav ====
       
        function submitApprovalRequestDOCOwner(RecordId,listid,ApprovalReqcomment,newOwner){
            Visualforce.remoting.Manager.invokeAction(
                // @RemoteAction
                '{!$RemoteAction.DocumentProfileControllerExt.submitApprovalRequestDOCOwner}',RecordId,listid,ApprovalReqcomment,newOwner,function(result, event){
                    if(event.status){                       
                        // window.location.href = '/apex/DocumentProfile?id='+'{!JSENCODE(Document_Profile__c.Id)}&pg={!JSENCODE($CurrentPage.parameters.pg)}';
                         window.location.reload();
                    }
                });       
        } 
    
    
    /* v1.7     start*/
        function genSubmitApprovalRequest(RecordId){
            Visualforce.remoting.Manager.invokeAction(
                // @RemoteAction
                '{!$RemoteAction.Approvalclass.genSubmitApprovalRequest}',RecordId,function(result, event){
                    if(event.status){                       
                        // window.location.href = '/apex/DocumentProfile?id='+'{!JSENCODE(Document_Profile__c.Id)}&pg={!JSENCODE($CurrentPage.parameters.pg)}';
                         window.location.reload();
                    }
                });       
        }
    /* v1.7     end*/   
    
   
    
    
    function cancelPopup(){
        var YESButtonInRedirectModalOnClick = function () {
            window.location.href = '/apex/qlt_dashboard';
        };
        var NOButtonInRedirectModalOnClick = function () {
            
        };
        $('#redirectDialog .btn-primary').bind( "click", YESButtonInRedirectModalOnClick);
        $('#redirectDialog .btn-default').bind( "click", NOButtonInRedirectModalOnClick);
        
        // Show the redirect dialog
        $('#redirectDialog').modal('show');
        
        // Remove the onClick event
        $('#redirectDialog').on('hidden.bs.modal', function () {
            $('#redirectDialog .btn-primary').unbind( "click", YESButtonInRedirectModalOnClick);
            $('#redirectDialog .btn-default').unbind( "click", NOButtonInRedirectModalOnClick);
        }) 
    }
    
    <!--------------approval process javascript function-----------added by balu------------------------>
        var DocumentDetailsSubmitvar=false;
        function hidesubmitbutton(arg){
        console.log('inside hide button'); 
            console.log($('#DocumentDetailsSubmit').hasClass('hidden')); 
            if(arg=='docdetails'){
                if(!$('#Collaboration_Review__c_slider').hasClass('active')){
                $('#DocumentDetailsSubmit').removeClass('hidden');
                }
            }else{
                $('#DocumentDetailsSubmit').addClass('hidden');
            }
            
        
        }
    
        $( document ).ready(function() {
            $('#{!IF(NOT(ISBLANK(Prefix)),Prefix+'__','')}New_Due_Date__c').datetimepicker({dayViewHeaderFormat: 'DD MMM YYYY', format: "DD MMM YYYY"});
            $('.LI_decision').hide();
            $('.doVerifyUserNameButton').hide(); 
            $('#ApprovaButtonIdNcContainment').hide(); 
            var flag=false;
            
            var taskId="{!JSENCODE(DocumentProfile.id)}";
            Visualforce.remoting.Manager.invokeAction(
                // @RemoteAction
                '{!$RemoteAction.Approvalclass.getApprover}',taskId,function(result, event){
                    if(result.length!=0){
                        if(result[0].hasOwnProperty('Workitems')){
                            
                            
                            $.each(result[0].Workitems,function(i, record) {
                                console.log(record);
                                if(record.ActorId=='{!JSENCODE($User.id)}')
                                {   
                                    flag=true;
                                }
                            }); 
                            if(flag){
                                
                                $('.LI_decision').show();
                                $('.doVerifyUserNameButton').show();
                                $('#ApprovaButtonIdNcContainment').show(); 
                            }
                            
                            if(result[0].SubmittedById=='{!JSENCODE($User.id)}'){
                                $('#javascriptidForApprovalbutton_decision_wiz-fields-wide').hide();  
                                $('#javascriptidForApprovalbutton_Comment_Required').show(); 
                                $('#javascriptidForApprovalbutton__ApprovalRescomment').addClass('javascriptidForApprovalbutton_required');   
                                recall=true;
                                
                            }
                            
                        }
                        else{
                            $('.LI_decision').hide();
                            $('.doVerifyUserNameButton').hide();  
                            $('#ApprovaButtonIdNcContainment').show();
                            
                        }  
                        
                    }
                    else{                                       
                        $('.LI_decision').hide();
                        $('.doVerifyUserNameButton').hide(); 
                        $('#ApprovaButtonIdNcContainment').hide();
                    }
                });
        });
    
    
    
    function ApprovePopupModal(){
        $('#ahrefjavascriptidForApprovalbutton_LI_decision').html('Approve');
        $('.LI_decision').show();
        $('#javascriptidForApprovalbutton_decision_wiz-fields-wide').show();  
        $('#javascriptidForApprovalbutton_header').html('Approve {!JSENCODE($CurrentPage.Parameters.type)} Approval');
        $('#javascriptidForApprovalbutton_Comment_Required').hide(); 
        $('.doVerifyUserNameButton').show();
        $('#ApprovaButtonIdNcContainment').show(); 
        $('#javascriptidForApprovalbutton__ApprovalRescomment').removeClass('javascriptidForApprovalbutton_required');
        $('#javascriptidForApprovalbutton').modal('show');
        $('#javascriptidForApprovalbutton_user_name').val('');
        $('#javascriptidForApprovalbutton_password').val('');       
        $('#javascriptidForApprovalbutton__ApprovalRescomment').val('');
        recall=false;
    }  
    function RecallPopupModal(){
        $('.LI_decision').hide();
        $('.doVerifyUserNameButton').hide(); 
        $('#ahrefjavascriptidForApprovalbutton_LI_decision').html('Recall');
        $('#javascriptidForApprovalbutton_decision_wiz-fields-wide').hide();  
        $('#javascriptidForApprovalbutton_header').html('Recall {!JSENCODE($CurrentPage.Parameters.type)} Approval');
        $('#javascriptidForApprovalbutton_Comment_Required').show(); 
        $('#javascriptidForApprovalbutton__ApprovalRescomment').addClass('javascriptidForApprovalbutton_required');   
        $('#javascriptidForApprovalbutton').modal('show');
        $('#javascriptidForApprovalbutton_user_name').val('');
        $('#javascriptidForApprovalbutton_password').val('');  
        $('#javascriptidForApprovalbutton__ApprovalRescomment').val('');                    
        recall=true;
    }
    function SubmitApprovalRequest(RecordId,UserId,listid,ApprovalReqcomment,FieldId,TochangeFieldName,newDueDate){
        Visualforce.remoting.Manager.invokeAction(
            // @RemoteAction
            '{!$RemoteAction.Approvalclass.submitApprovalRequest}',RecordId,UserId,listid,ApprovalReqcomment,FieldId,TochangeFieldName,newDueDate,function(result, event){
                if(event.status){
                    location.reload();
                }
            });
        
    }
    
    function ApprovalResponse(RecordId,ApprovalRescomment,approved,FieldId){
        Visualforce.remoting.Manager.invokeAction(
            // @RemoteAction
            '{!$RemoteAction.Approvalclass.submitApprovalResponse}',RecordId,ApprovalRescomment,approved,FieldId,function(result, event){
                if(event.status){
                    //alert('sucess');
                    location.reload();
                }
            });
    }
    function ChangeFieldRequest(RecordId,listid,ApprovalReqcomment,FieldId,value,datatype,submitforApproval,label){
        Visualforce.remoting.Manager.invokeAction(
            // @RemoteAction
            '{!$RemoteAction.Approvalclass.ChangeFieldRequest}',RecordId,listid,ApprovalReqcomment,FieldId,value,datatype,submitforApproval,label,
            function(result, event){
                if(event.status){
                    location.reload();                                                                                                        
                }
            });
    }
    <!-------approval process javascript function---end -------->    
        

    
    
    </script>
    
     
    
    
    <apex:outputPanel rendered="{!OR(JSENCODE($CurrentPage.parameters.pg)=='doc_init',ISBLANK($CurrentPage.parameters.pg))}">
        
        <script>
        function onValidInit(){
            //if({!NOT(ISBLANK(JSENCODE(documentProfile.Id)))}){
            //    $('#docForm').submit();
            //}
            //else{
            var isDigitalneeded = "<apex:outputtext value="{!$Setup.QC_settings__c.Is_Digital_Signature_Needed__c}" />";
            if(isDigitalneeded=='true'){
                $('#uname').val('');$('#pw').val('');$('.dont-allow-multiple-clicks').removeAttr('disabled'); $('#signature').modal('show');
            }else{
                navigateAfterDigitalSignature();
            }
            //}
        }
        
        function navigateAfterDigitalSignature(){
            if(!$('.dont-allow-multiple-clicks').attr('disabled')){
                $('.dont-allow-multiple-clicks').attr('disabled', true);
            } 
            $('#docForm').submit();
        }
        
        </script>
    </apex:outputPanel>
    <div id="container" class="{!if($CurrentPage.parameters.pg=='doc_Details_Print','hidden','')}">
        <apex:composition template="qualityze_app_layout">
            <apex:define name="header_bar_component">           
                <!--Begin : Header Bar With Search Option -->               
                <c:header_bar ObjectType="{!$ObjectType.Document_Profile__c}" ObjectTypeLinkTitle="Document Profile"/>                
                <!--End  : Header Bar With Search Option -->
            </apex:define> 
            
            <apex:define name="theheader">
                <c:DocumentProfile_Header docrecordID="{!Document_Profile__c.Id}" rendered="{!NOT(ISBLANK(Document_Profile__c.Id))}"></c:DocumentProfile_Header>
                
           
              <!--Message(Start)-->
                <div id="Tempnewmessage" class="alert alert-warning alert-dismissible hidden" role="alert" style="padding: 8px 35px 8px 15px">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">�</span>
              </button>
              <strong>Warning !</strong> This is a Temporary Deviated document.
                </div>
                <!--Message(End)-->
                
                 <!--Message(Start)-->
                <div id="Tempoldmessage" class="alert alert-warning alert-dismissible hidden" role="alert" style="{!IF(gtask.Status__c=='Void','display:visible','display:none')};">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">�</span>
              </button>
              <strong>Warning !</strong> Temporary Deviation of this document exists.
                </div>
                <!--Message(End)-->
            
            
            
            
            </apex:define>
            
            
            
            <apex:define name="wizsteps">
                <!-- To do   -->
                <!--temporary by balu start-->
                
                 <c:Document_Steps DocumentProfiles="{!DocumentProfile}" rendered="{!NOT(ISBLANK(Document_Profile__c.Id))}" subTask="{!Document_Profile__c.General_Tasks__r}"></c:Document_Steps>
                  <div class="clearfix"></div>  
                <!--temp by balu end-->
            </apex:define> 
            <apex:define name="from-holder-title">
                <apex:outputText value="{!IF(OR($CurrentPage.parameters.pg=='doc_init',ISBLANK($CurrentPage.parameters.id)),$Label.Document_Initiation,IF(OR($CurrentPage.parameters.pg=='doc_prof',ISBLANK($CurrentPage.parameters.pg)),$Label.Document_Details,IF($CurrentPage.parameters.pg=='doc_Approval',$Label.Document_Approval,IF($CurrentPage.parameters.pg=='doc_Details',$Label.Document_Details,'Document Initation'))))}" />
            </apex:define>
            
           
            
            <apex:define name="theform">
                
                
                <!--v1.4---start---->
                <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Document_Menu}" var="f" > 
                    <c:wizard_ChangeField field="{!f}__CHID"
                                          datatype="{!$ObjectType.Document_Profile__c.Fields[f].type}"
                                          recordId="{!Document_Profile__c.Id}"
                                          ModalId="{!f}DocModal"
                                          fieldlabel="{!$ObjectType.Document_Profile__c.Fields[f].label}"
                                          sObjJsid="DocJS{!f}" ToChangeFieldId="{!f}__CHID" TochangeFieldName="{!f}" >
                        <c:wiz_field Wide="{!OR($ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].type=='multipicklist',f==IF(NOT(ISBLANK(Prefix)),Prefix+'__Title__c','Title__c'))}"
                                     FieldLabel="{!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}"
                                     required="{!f.required}" jsid="{!LEFT(f,LEN(f)-3)}"
                                     rendered="{!$ObjectType.Document_Profile__c.Fields[f].Accessible}">
                            <c:wiz_date rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='date'}"
                                        FieldId="{!f}__ID" required="{!if(f.required,'','none')}none"
                                        FieldName="{!f}__Name" initdate="{!documentProfile[f]}"
                                        updateable="false">
                            </c:wiz_date>
                        </c:wiz_field>
                        <c:wiz_field Wide="{!OR($ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].type=='multipicklist',f==IF(NOT(ISBLANK(Prefix)),Prefix+'__Title__c','Title__c'))}"
                                     FieldLabel="{!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}"
                                     required="{!f.required}" jsid="{!LEFT(f,LEN(f)-3)}"
                                     rendered="{!$ObjectType.Document_Profile__c.Fields[f].Accessible}">
                            <c:wiz_date rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='date'}"
                                        FieldId="{!f}__CHID" required="{!if(f.required,'','none')}none"
                                        FieldName="{!f}__CHID" initdate=""
                                        updateable="true">
                            </c:wiz_date>
                        </c:wiz_field>
                        <script>                            
                        var Maxday = new Date();
                        Maxday.setFullYear(2020);
                        $(document).ready(function() {
                            $("#{!f}__CHID").datetimepicker({dayViewHeaderFormat: 'DD MMM YYYY', format: "DD MMM YYYY",maxDate: Maxday });
                        });
                        $(document).ready(function() {
                            $("#{!f}__ID").datetimepicker({dayViewHeaderFormat: 'DD MMM YYYY', format: "DD MMM YYYY",maxDate: Maxday});
                        });
                        </script>
                    </c:wizard_ChangeField>                
                </apex:repeat>                
                <!--v1.4--END----->
                <!-- Begin : Document Initiation -->
                <apex:outputPanel rendered="{!OR(ISBLANK($CurrentPage.parameters.id))}">
                    <c:wiz_form FormId="docForm" FormClass="appform validate"
                                postSaveJS=" {!IF(NOT(ISBLANK($CurrentPage.parameters.gnrlid)),'redirectTocompAction(RecordId)','redirectToDocinitiationPage(RecordId)')}"
                                submitPage="stringify_sobject" RecordId="{!documentProfile.Id}">
                        <input type="hidden" name="sobj" value="Document_Profile__c" />
                        <input type="hidden" name="page" id="page" value="doc_init" />
                        <input type="hidden" id="stepName" name="stepName" value="Initiation" />
                        <input type="hidden" name="{!IF(NOT(ISBLANK(Prefix)),Prefix+'__','')}Status__c" id="status" value="{!IF(ISBLANK(documentProfile.Id),'Draft',documentProfile.Status__c)}"/>
                        
         <apex:outputPanel rendered="{!AND(NOT(ISBLANK($CurrentPage.parameters.chmgmtId)),NOT(ISBLANK($CurrentPage.parameters.gnrlid)))}">
                          <script type="text/javascript">
                           
                                var changemanageentId = '{!JSENCODE($CurrentPage.parameters.chmgmtId)}';
                                var generalTaskids = '{!JSENCODE($CurrentPage.parameters.gnrlid)}';
                                var subchangeIds = '{!JSENCODE($CurrentPage.parameters.subCMid)}';
                                var doctype = '{!JSENCODE($CurrentPage.parameters.dcType)}';
                                var specChanges = '{!JSENCODE($CurrentPage.parameters.docchange)}';
                                function redirectTocompAction(recordids){
                               // alert('function called');
                                    updateActstatus(changemanageentId,subchangeIds,recordids,doctype,specChanges);        
                                }
                                
                                function updateActstatus(chaMgmtId,subCMId,recId,docmtype,specChanges){
                                // alert('function updateaction status');
                                   Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.DocumentProfileControllerExt.updateActStatusOnNewDoc}',chaMgmtId,subCMId,recId,docmtype,specChanges,function(result, event){ 
                                       if(event.status){
                                       //alert('update successful');
                                            window.location.href="/apex/ChangeManagementTask?id="+changemanageentId+"&gtid="+generalTaskids+"&pg=doc_change&type=DocumentChange";
                                       }                             
                                   });      
                                }
                          </script>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!OR(JSENCODE($CurrentPage.parameters.pg)=='doc_init',ISBLANK($CurrentPage.parameters.pg))}">
                        <script type='text/javascript'>
                            // alert('inside document flow output panel');
                           function redirectToDocinitiationPage(recordId){
                               
                               window.location.href = '/apex/DocumentProfile?id=' + recordId + '&pg=doc_prof';
                           }
                        </script>
                        </apex:outputPanel>
                             
                        
                        <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Initiation_Fields}" var="f">
                            <c:wiz_field Wide="{!OR($ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].type=='multipicklist',f==IF(NOT(ISBLANK(Prefix)),Prefix+'__Title__c','Title__c'))}"
                                         FieldLabel="{!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}"
                                         required="{!f.required}" jsid="{!LEFT(f,LEN(f)-3)}"
                                         rendered="{!$ObjectType.Document_Profile__c.Fields[f].Accessible}">
                                <div class="clearfix"></div>
                                <c:wiz_input rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='string'}"
                                             fieldId="{!f}" fieldname="{!f}"
                                             initvalue="{!documentProfile[f]}" required="{!f.required}"
                                             disabled="{!OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))}"></c:wiz_input>
                                
                                
                                <c:wiz_richtext rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].htmlFormatted,NOT(OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))))}"
                                                FieldId="{!f}" FieldName="{!f}"
                                                initvalue="{!documentProfile[f]}" Required="{!f.required}" maxlength="4000"></c:wiz_richtext>
                                <apex:outputpanel rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].htmlFormatted,OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable)))}">
                                    <div class="alert alert-info">
                                        <apex:outputField value="{!documentProfile[f]}" />
                                    </div>
                                </apex:outputpanel>
                                
                                <c:wiz_textarea rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='textarea',NOT($ObjectType.Document_Profile__c.Fields[f].htmlFormatted),NOT(OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))))}"
                                                ObjectName="{!$ObjectType.Document_Profile__c.name}"
                                                FieldId="{!f}" FieldName="{!f}"
                                                initvalue="{!documentProfile[f]}" Required="{!f.required}"></c:wiz_textarea>
                                <apex:outputpanel rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='textarea',NOT($ObjectType.Document_Profile__c.Fields[f].htmlFormatted),OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable)))}">
                                    <div class="alert alert-info">
                                        <apex:outputField value="{!documentProfile[f]}" />
                                    </div>
                                </apex:outputpanel>
                               <!--
                                <c:wiz_multi width="100%"
                                             rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}"
                                             required="{!f.required}" FieldId="{!f}" multiple="false"
                                             queryFields="{!IF(f=='Document_Type__c','Title__c,Name','Name')}"
                                             querytable="{!IF(f=='OwnerId','User',$ObjectType.Document_Profile__c.Fields[f].referenceTo[0])}"
                                             initvalues="{value:'{!if(NOT(ISBLANK(documentProfile[f])),JSENCODE(documentProfile[f]),if(f=='OwnerId',$User.Id,IF(f=='Document_Type__c',IF(NOT(ISBLANK($CurrentPage.parameters.dtid)),$CurrentPage.parameters.dtid,documentProfile[f]),documentProfile[f])))}',label:'{!if(NOT(ISBLANK(documentProfile[f])),JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].title__c),if(f=='OwnerId',JSENCODE($User.FirstName) + ' ' + JSENCODE($User.LastName),IF(f=='Document_Type__c',IF(NOT(ISBLANK($CurrentPage.parameters.dtitle)),$CurrentPage.parameters.dtitle,documentProfile[f]),documentProfile[f])))}'}"
                                             disabled="{!OR(documentProfile.Status__c=='Void',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))}">
                                            
                                </c:wiz_multi>-->
                                <c:wiz_multi width="100%"
                                             rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}"
                                             required="{!f.required}" FieldId="{!f}" multiple="false"
                                             queryFields="{!IF(f=='Document_Type__c','Title__c,Name','Name')}"
                                             querytable="{!IF(f=='OwnerId','User',$ObjectType.Document_Profile__c.Fields[f].referenceTo[0])}"
                                             initvalues="{value:'{!if(NOT(ISBLANK(documentProfile[f])),JSENCODE(documentProfile[f]),if(f=='OwnerId',$User.Id,IF(f=='Document_Type__c',IF(NOT(ISBLANK($CurrentPage.parameters.dtid)),$CurrentPage.parameters.dtid,documentProfile[f]),documentProfile[f])))}',label:'{!if(NOT(ISBLANK(documentProfile[f])),if(f=='Document_Type__c',JSENCODE(documentProfile.Document_Type__r.Title__c),JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)),if(f=='OwnerId',JSENCODE($User.FirstName) + ' ' + JSENCODE($User.LastName),IF(f=='Document_Type__c',IF(NOT(ISBLANK($CurrentPage.parameters.dtitle)),$CurrentPage.parameters.dtitle,documentProfile[f]),documentProfile[f])))}'}"
                                             disabled="{!OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))}">
                                            
                                </c:wiz_multi>
                                <c:wiz_select ObjectName="{!IF(NOT(ISBLANK(Prefix)),Prefix+'__','')}Document_Profile__c"
                                              developername="{!f}" onChangeFunction="" width="100%"
                                              rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='picklist'}"
                                              FieldId="{!f}" FieldName="{!f}"
                                              initvalue="{!documentProfile[f]}"
                                              unSelectedDisplayText="   " Required="{!f.required}"
                                              disabled="{!OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))}"></c:wiz_select>
                                <apex:outputPanel rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='multipicklist')}">
                                    
                                    <select id="{!f}" name="{!f}" class="form-control"
                                            multiple="multiple" style="width: 100%;"></select>
                                    
                                    
                                </apex:outputPanel>
                            </c:wiz_field>
                        </apex:repeat>
                        
                      
                        <div class="clearfix"></div>
                        
                        <apex:variable value="{!0}" var="showCustomFieldSection"/>
                        <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Document_Profile_Custom_Fields}" var="f">
                            <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].Accessible}">
                                <apex:variable value="{!showCustomFieldSection+1}" var="showCustomFieldSection"/>
                            </apex:outputPanel>
                        </apex:repeat>
                        <apex:outputPanel rendered="{!AND($ObjectType.Document_Profile__c.FieldSets.Document_Profile_Custom_Fields.size!=0,showCustomFieldSection!=0)}">
                            <div class="push-down panel-group"></div>
                            <div class="panel-group col-md-12" id="accordionCustomFields" role="tablist"
                                 aria-multiselectable="true">
                                <div class="panel panel-default">
                                    <div class="panel-heading" role="tab" id="headingOneCustomFields">
                                        <h4 class="panel-title">
                                            <a data-toggle="collapse" data-parent="#accordionCustomFields"
                                               href="#collapseOneCustomFields" aria-expanded="true"
                                               aria-controls="collapseOne" class="collapsed"> <span class="col-exp"></span> Custom Fields
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapseOneCustomFields" class="panel-collapse collapse out" role="tabpanel" aria-labelledby="headingOne">
                                        <div class="panel-body">
                                            <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Document_Profile_Custom_Fields}"
                                                         var="f">
                                                <c:wiz_field Wide="{!OR($ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].type=='multipicklist',f==IF(NOT(ISBLANK(Prefix)),Prefix+'__UD_text9__c','UD_text9__c'))}"
                                                             FieldLabel="{!$ObjectType.Document_Profile__c.Fields[f].Label}"
                                                             required="{!f.required}" jsid="{!LEFT(f,LEN(f)-3)}"
                                                             rendered="{!$ObjectType.Document_Profile__c.Fields[f].Accessible}">
                                                    <div class="clearfix"></div>
                                                    <c:wiz_richtext maxlength="{!if($ObjectType.Document_Profile__c.Fields[f].length>2000,2000,$ObjectType.Document_Profile__c.Fields[f].length)}" rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].htmlFormatted,NOT(OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))))}" 
                                                                    FieldId="{!f}" FieldName="{!f}"
                                                                    initvalue="{!documentProfile[f]}"
                                                                    Required="{!f.required}"></c:wiz_richtext>
                                                    <apex:outputpanel rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].htmlFormatted,OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable)))}">
                                                        <div class="alert alert-info">
                                                            <apex:outputField value="{!documentProfile[f]}"/>
                                                        </div>
                                                    </apex:outputpanel>
                                                    <c:wiz_textarea maxlength="{!if($ObjectType.Document_Profile__c.Fields[f].length>2000,2000,$ObjectType.Document_Profile__c.Fields[f].length)}" rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='textarea',NOT($ObjectType.Document_Profile__c.Fields[f].htmlFormatted),NOT(OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))))}"
                                                                    ObjectName="{!$ObjectType.Document_Profile__c.name}"
                                                                    FieldId="{!f}" FieldName="{!f}"
                                                                    initvalue="{!documentProfile[f]}"
                                                                    Required="{!f.required}" disabled="{!OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval')}"></c:wiz_textarea>
                                                    <apex:outputpanel rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='textarea',NOT($ObjectType.Document_Profile__c.Fields[f].htmlFormatted),OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable)))}">
                                                        <div class="alert alert-info">
                                                            <apex:outputField value="{!documentProfile[f]}" />
                                                        </div>
                                                    </apex:outputpanel>
                                                    <c:wiz_date rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='date'}"
                                                                FieldId="{!f}" required="{!if(f.required,'','none')}none"
                                                                FieldName="{!f}" initdate="{!documentProfile[f]}"
                                                                updateable="{!NOT(OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable)))}"
                                                                >
                                                    </c:wiz_date>

                                                    <c:wiz_multi width="100%"
                                                                 rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}"
                                                                 required="{!f.required}" FieldId="{!f}" multiple="false"
                                                                 queryFields="{!IF(f=='CD_Customer__c','Name','Name')}"
                                                                 querytable="{!IF(f=='OwnerId','User',$ObjectType.Document_Profile__c.Fields[f].referenceTo[0])}"
                                                                 filtervalue="{!if(AND(contains(FilterKeys,'Document_Profile__c'),contains(subkey['Document_Profile__c'],f)),LookupFilter[f].Filter_Value__c,'')}"
                                                                 initvalues="{value: '{!JSENCODE(documentProfile[f])}', label:'{!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}'}"
                                                                 disabled="{!OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))}">
                                                        
                                                    </c:wiz_multi>
                                                    <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='date'}">
                                                        <script>                            
                                                        $(document).ready(function() {
                                                            $("#{!f}").datetimepicker({dayViewHeaderFormat: 'DD MMM YYYY', format: "DD MMM YYYY" });
                                                        });
                                                        </script>
                                                        
                                                    </apex:outputPanel>
                                                    
                                                    <c:wiz_select ObjectName="{!IF(NOT(ISBLANK(Prefix)),Prefix+'__','')}Document_Profile__c"
                                                                  developername="{!f}" onChangeFunction="" width="100%"
                                                                  rendered="{!OR($ObjectType.Document_Profile__c.Fields[f].type=='picklist')}"
                                                                  FieldId="{!f}" FieldName="{!f}"
                                                                  initvalue="{!IF(AND(ISBLANK(documentProfile[f]),f=='Source__c'),'Document',documentProfile[f])}"
                                                                  unSelectedDisplayText="   " Required="{!f.required}"
                                                                  disabled="{!OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))}"></c:wiz_select>
                                                    <apex:outputPanel rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='multipicklist')}">
                                                        
                                                        <select id="{!f}" name="{!f}" class="form-control"
                                                                multiple="multiple" style="width: 100%;"></select>
                                                        
                                                        
                                                    </apex:outputPanel>
                                                    <c:wiz_input maxlength="{!if($ObjectType.Document_Profile__c.Fields[f].length>2000,2000,$ObjectType.Document_Profile__c.Fields[f].length)}" rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='string'}"
                                                                 fieldId="{!f}" fieldname="{!f}"
                                                                 initvalue="{!documentProfile[f]}"
                                                                 required="{!f.required}"
                                                                 disabled="{!OR(documentProfile.Status__c=='Void',documentProfile.Status__c =='Current',documentProfile.Status__c =='Revised',documentProfile.Status__c =='Expired',documentProfile.Approval_Status__c=='Pending Approval',NOT($ObjectType.Document_Profile__c.Fields[f].updateable))}"></c:wiz_input>
                                                </c:wiz_field>
                                            </apex:repeat>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </apex:outputPanel>
                        
                    </c:wiz_form>
                </apex:outputPanel>
                <apex:outputPanel rendered="{!AND(OR($CurrentPage.parameters.pg=='doc_prof',ISBLANK($CurrentPage.parameters.pg)),NOT(ISBLANK($CurrentPage.parameters.id)))}">
                    <script>
                        var rId,documentStatus;
                        $(document).ready(function() {
                            $("#documentTableTbody>tr").not(':first').each(function(){
                                rId = $(this).attr('id');
                                documentStatus = $('#'+rId+'_status').text();
                                if(documentStatus != 'Current'){
                                    $(this).hide();
                                }                               
                            });        
                        });
                        var checkedCAPAs = [],checkedDocs = [],deletedIds = [],checkedNCs = [], checkedDoc = {} , docArray = {} ;
                        function cancelPopup()
                        {
                           var YESButtonInRedirectModalOnClick = function () {
                               window.location.href = '/apex/DocumentProfile?id={!JSENCODE($CurrentPage.parameters.id)}&pg=doc_prof'
                           };
                           var NOButtonInRedirectModalOnClick = function () {
                               
                           };
                           $('#redirectDialog .btn-primary').bind( "click", YESButtonInRedirectModalOnClick);
                           $('#redirectDialog .btn-default').bind( "click", NOButtonInRedirectModalOnClick);
                           
                           // Show the redirect dialog
                           $('#redirectDialog').modal('show');
                           
                           // Remove the onClick event
                           $('#redirectDialog').on('hidden.bs.modal', function () {
                               $('#redirectDialog .btn-primary').unbind( "click", YESButtonInRedirectModalOnClick);
                               $('#redirectDialog .btn-default').unbind( "click", NOButtonInRedirectModalOnClick);
                           })
                        }
                        
                        function onSubmit(){

                            
                            var isDigitalneeded = "<apex:outputtext value="{!$Setup.QC_settings__c.Is_Digital_Signature_Needed__c}" />";
                            if(isDigitalneeded == 'true'){
                                $('#uname').val('');
                                $('#pw').val('');
                                $('.dont-allow-multiple-clicks').removeAttr('disabled');
                                $('#signature').modal('show');
                            }else if(isDigitalneeded == 'false'){    
                                $('#Submit').attr('disabled', 'true');
                                saveDocumentProfile();
                            }
                        }
                    
                                            
                        function removeRow(rowId){
                            console.log('rowId '+rowId);
                            deletedIds.push(rowId);
                            $("#"+rowId).remove();
                        }
                
                        var index,flag=false;
                        function ncActions(tId,rowId){
                            console.log('rowId '+rowId);
                            if($(tId).attr('class') == 'fa fa-plus action-link'){
                                $(tId).attr('class','fa fa-check action-link');
                                $("#ncTbody").find("#"+rowId).attr('class','warning');
                                checkedNCs.push(rowId);
                                index = deletedIds.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    deletedIds.splice(index, 1);
                                }
                                
                            }else if($(tId).attr('class') == 'fa fa-remove action-link'){
                                $(tId).attr('class','fa fa-plus action-link');
                                flag = true;
                                checkList(flag);
                                deletedIds.push(rowId);
                                index = checkedNCs.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    checkedNCs.splice(index, 1);
                                }
                                
                            }else if($(tId).attr('class') == 'fa fa-check action-link'){
                                $(tId).attr('class','fa fa-plus action-link');
                                $("#ncTbody").find("#"+rowId).attr('class','');
                                flag = true;
                                checkList(flag);
                                index = deletedIds.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    deletedIds.splice(index, 1);
                                }else{
                                    deletedIds.push(rowId);
                                }   
                                index = checkedNCs.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    checkedNCs.splice(index, 1);
                                }   
                            }
                            
                        }
                    
                        function capaActions(tId,rowId){
                            if($(tId).attr('class') == 'fa fa-plus action-link'){
                                $(tId).attr('class','fa fa-check action-link');
                                $("#capaTbody").find("#"+rowId).attr('class','warning');
                                checkedCAPAs.push(rowId);
                                index = deletedIds.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    deletedIds.splice(index, 1);
                                }
                                
                            }else if($(tId).attr('class') == 'fa fa-remove action-link'){
                                $(tId).attr('class','fa fa-plus action-link');
                                flag = true;
                                checkList(flag);
                                deletedIds.push(rowId);
                                index = checkedCAPAs.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    checkedCAPAs.splice(index, 1);
                                }
                                
                            }else if($(tId).attr('class') == 'fa fa-check action-link'){
                                $(tId).attr('class','fa fa-plus action-link');
                                $("#capaTbody").find("#"+rowId).attr('class','');
                                flag = true;
                                checkList(flag);
                                index = deletedIds.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    deletedIds.splice(index, 1);
                                }else{
                                    deletedIds.push(rowId);
                                }   
                                index = checkedCAPAs.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    checkedCAPAs.splice(index, 1);
                                }   
                            }
                            
                        }
                        
                        var relation;
                        function docActions(tId,rowId){
                            console.log('rowId '+rowId);
                            if($(tId).attr('class') == 'fa fa-plus action-link'){
                                $(tId).attr('class','fa fa-check action-link');
                                $("#docTbody").find("#"+rowId).attr('class','warning');
                                checkedDocs.push(rowId);
                                checkedDoc = {};
                                checkedDoc['Id'] = rowId;
                                checkedDoc['Relation'] = $('#'+rowId+'_Select option:selected').val();
                                docArray[rowId] = checkedDoc;
                                console.log(docArray);
                                index = deletedIds.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    deletedIds.splice(index, 1);
                                }
                                
                            }else if($(tId).attr('class') == 'fa fa-remove action-link'){
                                $(tId).attr('class','fa fa-plus action-link');
                                flag = true;
                                checkList(flag);
                                deletedIds.push(rowId);
                                index = checkedDocs.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    checkedDocs.splice(index, 1);
                                }
                                
                            }else if($(tId).attr('class') == 'fa fa-check action-link'){
                                $(tId).attr('class','fa fa-plus action-link');
                                $("#docTbody").find("#"+rowId).attr('class','');
                                flag = true;
                                checkList(flag);
                                index = deletedIds.indexOf(rowId);
                                delete docArray[rowId];
                                console.log('index '+index);
                                if(index > -1){
                                    deletedIds.splice(index, 1);
                                }else{
                                    deletedIds.push(rowId);
                                }   
                                index = checkedDocs.indexOf(rowId);
                                console.log('index '+index);
                                if(index > -1){
                                    checkedDocs.splice(index, 1);
                                }   
                            }
                            
                        }
                    
                    var selectId,rowIdClass;
                    function selectRelation(sId,rowId){
                        rowIdClass = $('#'+rowId).find('i').attr('class');
                        if(rowIdClass == 'fa fa-check action-link'){
                            selectId = $(sId).attr('id'); 
                            checkedDoc = {};
                            checkedDoc['Id'] = rowId;
                            checkedDoc['Relation'] = $('#'+selectId+' option:selected').val();
                            docArray[rowId] = checkedDoc;
                        }                       
                    }
                    
                    function saveDocumentProfile(){
                        var activeTab = $('#tabNavigation').find('.active>a').attr('href');
                        console.log('activeTab '+activeTab);
                        if(activeTab == '#doc_reference'){
                            console.log('inside doc reference');
                            Visualforce.remoting.Manager.invokeAction(
                                // @RemoteAction
                                '{!$RemoteAction.DocumentProfileControllerExt.saveDocReferences}',deletedIds,'{!JSENCODE($CurrentPage.parameters.id)}',checkedNCs,checkedDocs,checkedCAPAs,docArray,
                                // Callback
                                function(result, event){
                                    if(result==0){
                                        console.log('record saved successfully');
                                        window.location.href = '/apex/DocumentProfile?id={!JSENCODE($CurrentPage.parameters.id)}&pg=doc_prof'
                                    }else{
                                        console.log('failed to save');
                                    }
                                });    
                        }
                        //================written by balu for document details
                        else if(activeTab=='#doc_details_doc_create'){
                            submitDocDetails();
                        }
                        //================written by balu for document details   
                        
                        else if(activeTab=='#doc_security'){
                                 
                               var security= $("#Enable_Security__c").val();  
                            // alert(security);
                           if((checkusrs=='' && checkgrps=='' && checkviewusrs =='' &&  checkviewgropusrs =='') && security=='true'){
                            
                            
                            showDialog('-1','Please Select atleast one User or Group!');
                        } 
                            else{
                                
                            //  alert(checkusrs);
                            var doctypeID = "{!$currentpage.parameters.id}";
                            var security= $("#Enable_Security__c").val();
                            console.log('check names  '+checknames);
            Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.DocumentProfileControllerExt.AuthorisedEntityUsersSave}',doctypeID,checkusrs,checknames,checkgrpsnames,checkviewusrsName,checkviewgropusrsName,security,checkgrps,checkviewusrs,checkviewgropusrs,
                                                      function(result, event) {
                                                          //  alert(result);
                                                          
                                                           window.location.href = '/apex/DocumentProfile?id={!JSENCODE($CurrentPage.parameters.id)}&pg=doc_prof'
                                                          
                                                      });
        
                                 
                                 
                            }
}                        
                    }
                    
                    
                    </script>
                    <input type="hidden" name="page" id="page" value="doc_prof" />
                    
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="dt_doc_profile">
                            <!-- Screen -->
                                    <div >
                                        <!-- Nav tabs -->
                                        <ul class="nav nav-tabs inpane-tabs" role="tablist" id="tabNavigation">
                                            <li role="presentation" id="doc_details_doc_createliId" class="active"><a href="#doc_details_doc_create" onclick="hidesubmitbutton('docdetails');" aria-controls="doc_details_doc_create" role="tab" data-toggle="tab">Details</a></li>
                                            <li role="presentation"><a href="#doc_security" aria-controls="doc_security" onclick="hidesubmitbutton('security');" role="tab" data-toggle="tab">Security</a></li>
                                            <li role="presentation"><a href="#doc_reference" aria-controls="doc_reference" onclick="hidesubmitbutton('reference');" role="tab" data-toggle="tab">Reference</a></li>
                                            <!--<li role="presentation"><a href="#doc_revision_history" aria-controls="doc_revision_history" role="tab" data-toggle="tab">Revision History</a></li>-->
                                            <li role="presentation"><a href="#doc_change_requests" aria-controls="doc_change_requests" onclick="hidesubmitbutton('changerequest');" role="tab" data-toggle="tab">Change Requests</a></li>
                                            
                                        </ul>
                                        
                                        <!-- Tab panes -->
                                        <div class="tab-content">
                                            <div role="tabpanel" class="tab-pane active" id="doc_details_doc_create">
                                                
                                                <div class="push-down tab-content" />
                                                <div class="tab-content">
                                                <input type="hidden" id="stepName" name="stepName" value="Document Details" />
                                                    <c:DocumentDetails DocProfileId="{!documentProfile.id}"
                                                                        readOnly="{!AND(OR(documentProfile.Status__c!='Draft',documentProfile.Approval_Status__c=='Pending Approval'))}"
                                                                       Prefix="{!Prefix}" DocumentProfile="{!documentProfile}" isChangeDocOwnerApprover="{!isChangeDocOwnerApprover}" isDocOwnerSubmitter="{!isDocOwnerSubmitter}"/><!-- v1.6 Removed isEdit currentPage parameter from readOnly attribute for DocumentDetailsComponent -->
                                                </div>
                                                
                                            </div><!-- Tab pane ends -->
                                            
                                            <script type="text/javascript">
                                             $( document ).ready(function() {   
                                               if( '{!documentProfile.Authorised_Entity_Users__c}' != '' ||  '{!documentProfile.Authorised_Entity_Groups__c}' != '' ||  '{!documentProfile.Viewonly_Entity_Users__c}' != '' ||  '{!documentProfile.Viewonly_Entity_Groups__c}' != ''  ){
                                                    
                                                     console.log('checking');
                                                     var selectedUsers='{!JSENCODE(documentProfile.Authorised_Entity_Users__c)}'.split(',');
                                                     var selectedUsersName='{!JSENCODE(documentProfile.Authorised_Entity_Users_Name__c)}'.split(',');
                                                     //alert(selectedUsers[0]);
                                                     for(var i=0;i<selectedUsers.length;i++){
                                                         console.log(selectedUsers[i].trim());
                                                         var tid= $("#"+selectedUsers[i].trim()).find("i");
                                                         console.log(tid);
                                                         usrsActions(tid,selectedUsers[i].trim(),selectedUsersName[i].trim());
                                                     }
                                                     
                                                     
                                                     var selectedGroup='{!JSENCODE(documentProfile.Authorised_Entity_Groups__c)}'.split(',');
                                                     var selectedGroupName='{!JSENCODE(documentProfile.Authorised_Entity_Groups_Name__c)}'.split(',');
                                                     
                                                     //alert(selectedGroup[0]);
                                                     for(var i=0;i<selectedGroup.length;i++){ 
                                                         console.log(selectedGroup[i].trim());
                                                         var gtId= $("#"+selectedGroup[i].trim()).find("i");
                                                         console.log(gtId);
                                                         grpsActions(gtId,selectedGroup[i].trim(),selectedGroupName[i].trim());
                                                     }
                                                     
                                                     
                                                     var selectedviewUsers='{!JSENCODE(documentProfile.Viewonly_Entity_Users__c)}'.split(',');
                                                     var selectedviewUsersName='{!JSENCODE(documentProfile.Viewonly_Entity_Users_Name__c)}'.split(',');
                                                     
                                                     //alert(selectedviewUsers[0]);
                                                     for(var i=0;i<selectedviewUsers.length;i++){
                                                         console.log(selectedviewUsers[i].trim());
                                                         var vtId= $("#"+"uva"+selectedviewUsers[i].trim()).find("i");
                                                         
                                                         
                                                         usrsviewActions(vtId,selectedviewUsers[i].trim(),selectedviewUsersName[i].trim());
                                                     }
                                                     
                                                     
                                                     
                                                     var selectedviewGroup='{!JSENCODE(documentProfile.Viewonly_Entity_Groups__c)}'.split(',');
                                                     var selectedviewGroupName='{!JSENCODE(documentProfile.Viewonly_Entity_Groups_Name__c)}'.split(',');
                                                     
                                                     // alert(selectedviewGroup[0]);
                                                     for(var i=0;i<selectedviewGroup.length;i++){
                                                         console.log(selectedviewGroup[i].trim());
                                                         var vgId= $("#"+"uga"+selectedviewGroup[i].trim()).find("i");
                                                         console.log(vgId);
                                                         viewgrpsActions(vgId,selectedviewGroup[i].trim(),selectedviewGroupName[i].trim());
                                                     }
                                                     
                                                     
                                                     
                                                 }
                                                 else{
                                                     
                                                 var selectedUsers='{!JSENCODE(documentProfile.Document_Type__r.Authorised_Entity_Users__c)}'.split(',');
                                                 var selectedUsersName='{!JSENCODE(documentProfile.Document_Type__r.Authorised_Entity_Users_Name__c)}'.split(',');
                                                 //alert(selectedUsers[0]);
                                                 for(var i=0;i<selectedUsers.length;i++){
                                                     console.log(selectedUsers[i].trim());
                                                     var tid= $("#"+selectedUsers[i].trim()).find("i");
                                                     console.log(tid);
                                                      usrsActions(tid,selectedUsers[i].trim(),selectedUsersName[i].trim());
                                                 }
                                                 
                                                 
                                                 var selectedGroup='{!JSENCODE(documentProfile.Document_Type__r.Authorised_Entity_Groups__c)}'.split(',');
                                                 var selectedGroupName='{!JSENCODE(documentProfile.Document_Type__r.Authorised_Entity_Groups_Name__c)}'.split(',');
                                                 //alert(selectedGroup[0]);
                                                 for(var i=0;i<selectedGroup.length;i++){ 
                                                     console.log(selectedGroup[i].trim());
                                                     var gtId= $("#"+selectedGroup[i].trim()).find("i");
                                                     console.log(gtId);
                                                   grpsActions(gtId,selectedGroup[i].trim(),selectedGroupName[i].trim());
                                                 }
                                                 
                                                 
                                                 var selectedviewUsers='{!JSENCODE(documentProfile.Document_Type__r.Viewonly_Entity_Users__c)}'.split(',');
                                                 var selectedviewUsersName='{!JSENCODE(documentProfile.Document_Type__r.Viewonly_Entity_Users_Name__c)}'.split(',');
                                                 //alert(selectedviewUsers[0]);
                                                 for(var i=0;i<selectedviewUsers.length;i++){
                                                     console.log(selectedviewUsers[i].trim());
                                                     var vtId= $("#"+"uva"+selectedviewUsers[i].trim()).find("i");
                                                     
                                                     
                                                     usrsviewActions(vtId,selectedviewUsers[i].trim(),selectedviewUsersName[i].trim());
                                                 }
                                                 
                                                 
                                                 
                                                 var selectedviewGroup='{!JSENCODE(documentProfile.Document_Type__r.Viewonly_Entity_Groups__c)}'.split(',');
                                                 var selectedviewGroupName='{!JSENCODE(documentProfile.Document_Type__r.Viewonly_Entity_Groups_Name__c)}'.split(',');
                                                 // alert(selectedviewGroup[0]);
                                                 for(var i=0;i<selectedviewGroup.length;i++){
                                                     console.log(selectedviewGroup[i].trim());
                                                     var vgId= $("#"+"uga"+selectedviewGroup[i].trim()).find("i");
                                                     console.log(vgId);
                                                     viewgrpsActions(vgId,selectedviewGroup[i].trim(),selectedviewGroupName[i].trim());
                                                 }
                                                     
                                                     }
                                                 
                                             });
                                            </script>
                                            
                                            
                                            <script type="text/javascript">
                                        var list=[],list2=[],uClass,gClass;
    
                                     $(document).ready(function() { 
                                                   

                                         <apex:repeat value="{!userList}" var="usr" >
                                             
                                             list.push('{!usr.id}'.split(','));
                                         </apex:repeat>    
                                         
                                         <apex:repeat value="{!groupList}" var="usr" >
                                             
                                             list2.push('{!usr.id}'.split(','));
                                         </apex:repeat>
                                                       
                                                           });
            
                                            var i=0;var j=0;var k=0;var l=0;
                                            
                                            
                                            function allusers(){

                                    $.each(list,function(user){

                                        $('#'+list[user]).show();
                                    });
                                }  
                                
                                
                                function allusersGrp(){
                                    $.each(list2,function(user){
                                        $('#'+list2[user]).show();
                                    });
                                }
                                
                                function allusersView(){
                                    $.each(list,function(user){
                                        $('#'+'uva'+list[user]).show();
                                    });
                                    
                                }
                                
                                
                                function allusersViewGrp(){
                                    $.each(list2,function(user){
                                        $('#'+'uga'+list2[user]).show();
                                    });
                                }  
                                
                                function unselectedusers(){
                                    $.each(list,function(user){
                                        uClass = $('#'+list[user]+'_checkids').attr('class');
                                        if(uClass == 'fa fa-check action-link'){
                                            $('#'+list[user]).hide();
                                        }else{
                                            $('#'+list[user]).show();
                                        }
                                    });
                                }
                                
                                
                                function unselectedusersGrp(){
                                    $.each(list2,function(user){
                                        gClass = $('#'+list2[user]+'_checkgrpids').attr('class');
                                        if(gClass == 'fa fa-check action-link'){
                                            $('#'+list2[user]).hide();
                                        }else{
                                            $('#'+list2[user]).show();
                                        }
                                    });
                                }
                                
                                
                                
                                function unselectedusersView(){
                                    $.each(list,function(user){
                                        uClass = $('#'+list[user]+'_checkviewids').attr('class');
                                        if(uClass == 'fa fa-check action-link'){
                                            $('#'+'uva'+list[user]).hide();
                                        }else{
                                            $('#'+'uva'+list[user]).show();
                                        }
                                    });
                                }
                                
                                function unselectedusersViewGrp(){
                                    $.each(list2,function(user){
                                        gClass = $('#'+list2[user]+'_checkgrpsids').attr('class');
                                        if(gClass == 'fa fa-check action-link'){
                                            $('#'+'uga'+list2[user]).hide();
                                        }else{
                                            $('#'+'uga'+list2[user]).show();
                                        }
                                    });
                                }
                                
                                
                                
                                var i=0;
                                function checkall(){
                                    checkusrs =[];
                                    checknames =[];
                                    var uName;
                                    
                                    $.each(list,function(user){
                                        $('#'+list[user]+'_checkids').attr('class','fa fa-check action-link');
                                        i++;
                                        uName=$('#'+list[user]).find('td').eq(0).text();
                                        checkusrs.push(list[user].toString());
                                        checknames.push(uName);
                                        $("#number").text(i); 
                                    });
                                }
                                
                                
                                 var j=0;
                                function checkallgroupGrp(){
                                    checkgrps =[];
                                    checkgrpsNames =[];
                                    var gName;
                                    
                                    $.each(list2,function(user){
                                        $('#'+list2[user]+'_checkgrpids').attr('class','fa fa-check action-link');
                                          j++;
                                        gName=$('#'+list2[user]).find('td').eq(0).text();
                                        checkgrps.push(list2[user].toString());
                                        checkgrpsNames.push(gName);
                                         $("#grnumber").text(j); 
                                    });
                                }
                                
                                 var k=0;
                                function checkallView(){
                                    checkviewusrs =[];
                                    checkviewusrsName =[];
                                    var uName;
                                    
                                    $.each(list,function(user){
                                        $('#'+list[user]+'_checkviewids').attr('class','fa fa-check action-link');
                                         k++;
                                        uName=$('#'+list[user]).find('td').eq(0).text();
                                        checkviewusrs.push(list[user].toString());
                                        checkviewusrsName.push(uName);
                                         $("#viewnumber").text(k); 
                                    });
                                }
                                
                                 var l=0;
                                function checkallgroupViewGrp(){
                                    checkviewgropusrs =[];
                                    checkviewgropusrsName =[];
                                    var gName;
                                    
                                    $.each(list2,function(user){
                                        $('#'+list2[user]+'_checkgrpsids').attr('class','fa fa-check action-link');
                                           l++;
                                        gName=$('#'+list2[user]).find('td').eq(0).text();
                                        checkviewgropusrs.push(list2[user].toString());
                                        checkviewgropusrsName.push(gName);
                                        $("#viewgrpnumber").text(l); 
                                    });
                                }
                                
                                function selectedusers(){
                                    $.each(list,function(user){
                                        uClass = $('#'+list[user]+'_checkids').attr('class');
                                        if(uClass == 'fa fa-plus action-link'){
                                            $('#'+list[user]).hide();
                                        }else{
                                            $('#'+list[user]).show();
                                        }
                                    });
                                } 
                                
                                
                                function selectedusersGrp(){
                                    $.each(list2,function(user){
                                        gClass = $('#'+list2[user]+'_checkgrpids').attr('class');
                                        if(gClass == 'fa fa-plus action-link'){
                                            $('#'+list2[user]).hide();
                                        }else{
                                            $('#'+list2[user]).show();
                                        }
                                    });
                                } 
                                
                                
                                function selectedusersView(){ 
                                    $.each(list,function(user){
                                        uClass = $('#'+list[user]+'_checkviewids').attr('class');
                                        if(uClass == 'fa fa-plus action-link'){
                                            $('#'+'uva'+list[user]).hide();
                                        }else{
                                            $('#'+'uva'+list[user]).show();
                                        }
                                    });
                                } 
                                
                                function selectedusersViewGrp(){
                                    $.each(list2,function(user){
                                        gClass = $('#'+list2[user]+'_checkgrpsids').attr('class');
                                        if(gClass == 'fa fa-plus action-link'){
                                            $('#'+'uga'+list2[user]).hide();
                                        }else{
                                            $('#'+'uga'+list2[user]).show();
                                        } 
                                    });
                                } 
                                
            
                                            
                                            
    
                           var checkusrs = [], deleteusrIds=[],checknames=[],deleteusrNames=[],index;
                
                             function usrsActions(tId,rowId,rowName){                                  
                                  
                               var total = [];
                                console.log('rowId issssss '+rowId);
                              if($(tId).attr('class') == 'fa fa-plus action-link'){
                                  i++;
                                  $("#number").text(i); 
                                  $(tId).attr('class','fa fa-check action-link');
                                $("#usrTbody").find("#"+rowId).attr('class','warning');
                                checkusrs.push(rowId);
                                 checknames.push(rowName);
                                index = deleteusrIds.indexOf(rowId);
                                console.log('index '+index);
                                console.log('check users '+checkusrs);
                                if(index > -1){
                                    deleteusrIds.splice(index, 1);
                                }
                                
                            }else if($(tId).attr('class') == 'fa fa-check action-link'){
                                i--;
                                $("#number").text(i); 
                                $(tId).attr('class','fa fa-plus action-link');
                                $("#usrTbody").find("#"+rowId).attr('class','');
                                index = deleteusrIds.indexOf(rowId);
                                index = deleteusrNames.indexOf(rowName);
                                console.log('index '+index);
                                if(index > -1){
                                    deleteusrIds.splice(index, 1);
                                    deleteusrNames.splice(index, 1);
                                }else{
                                    deleteusrIds.push(rowId);
                                    deleteusrNames.push(rowName);
                                }   
                                index = checkusrs.indexOf(rowId);
                                index = checknames.indexOf(rowName);
                                console.log('index '+index);
                                if(index > -1){
                                    checkusrs.splice(index, 1);
                                    checknames.splice(index, 1);
                                }   
                            }
                           
                                }
    
    
                                
                             var checkgrps = [], deletegrpsIds=[],checkgrpsnames=[],deletegrpsNames=[],indexval;
                
                             function grpsActions(gtId,growId,growName){                                  
                                  
                               
                                                                 
                               console.log('rowId '+growId);
                              if($(gtId).attr('class') == 'fa fa-plus action-link'){
                                  j++;
                                  $("#grnumber").text(j); 
                                  
                                $(gtId).attr('class','fa fa-check action-link');
                                $("#grpTbody").find("#"+growId).attr('class','warning');
                                checkgrps.push(growId);
                                checkgrpsnames.push(growName);
                                  
                                indexval = deletegrpsIds.indexOf(growId);
                                
                                console.log('index '+indexval);
                                if(indexval > -1){
                                    deletegrpsIds.splice(indexval, 1);
                                }
                                
                            }else if($(gtId).attr('class') == 'fa fa-check action-link'){
                                j--;
                                $("#grnumber").text(j); 
                                
                                $(gtId).attr('class','fa fa-plus action-link');
                                $("#grpTbody").find("#"+growId).attr('class','');
                                indexval = deletegrpsIds.indexOf(growId);
                                indexval = deletegrpsNames.indexOf(growName);
                                
                                console.log('index '+indexval);
                                if(indexval > -1){
                                    deletegrpsIds.splice(indexval, 1);
                                    deletegrpsNames.splice(indexval, 1);
                                    
                                }else{
                                    deletegrpsIds.push(growId);
                                    deletegrpsNames.push(growName);
                                    
                                }   
                                indexval = checkgrps.indexOf(growId);
                                indexval = checkgrpsnames.indexOf(growName);
                                
                                console.log('index '+indexval);
                                if(indexval > -1){
                                    checkgrps.splice(indexval, 1);
                                    checkgrpsnames.splice(indexval, 1);
                                    
                                }   
                            }
                           
                                }
    
        
    
                                 var checkviewusrs = [], deleteviewusrIds=[],checkviewusrsName=[],deleteviewusrName=[],indexview;
                
                             function usrsviewActions(vtId,vrowId,vrowName){                                  
                                  
                              
                              

                               console.log('rowId '+vrowId);
                              if($(vtId).attr('class') == 'fa fa-plus action-link'){
                                  k++;
                                  $("#viewnumber").text(k); 
                                         
                                $(vtId).attr('class','fa fa-check action-link');
                                $("#usrviewTbody").find("#"+vrowId).attr('class','warning');
                                checkviewusrs.push(vrowId);
                                checkviewusrsName.push(vrowName);
                                  
                                indexview = deleteviewusrIds.indexOf(vrowId);
                                console.log('index '+indexview);
                                if(indexview > -1){
                                    deleteviewusrIds.splice(indexview, 1);
                                }
                                
                            }else if($(vtId).attr('class') == 'fa fa-check action-link'){
                                k--;
                                $("#viewnumber").text(k); 
                                $(vtId).attr('class','fa fa-plus action-link');
                                $("#usrviewTbody").find("#"+vrowId).attr('class','');
                                indexview = deleteviewusrIds.indexOf(vrowId);
                                indexview = deleteviewusrName.indexOf(vrowName);
                                 console.log('index '+indexview);
                                if(indexview > -1){
                                    deleteviewusrIds.splice(indexview, 1);
                                    deleteviewusrName.splice(indexview, 1);
                                    
                                }else{
                                    deleteviewusrIds.push(vrowId);
                                    deleteviewusrName.push(vrowName);
                                    
                                }   
                                indexview = checkviewusrs.indexOf(vrowId);
                                indexview = checkviewusrsName.indexOf(vrowName);
                                
                                console.log('index '+indexview);
                                if(indexview > -1){
                                    checkviewusrs.splice(indexview, 1);
                                    checkviewusrsName.splice(indexview, 1);
                                    
                                }   
                            }
                           
                                }
                                
                                 var checkviewgropusrs = [], deleteviewgroupIds=[],checkviewgropusrsName=[],deleteviewgroupName=[],indexgroupview;
                
                             function viewgrpsActions(vgId,vgrowId,vgrowName){                                  
                                  
                               
                                                                 
                               console.log('rowId '+vgrowId);
                              if($(vgId).attr('class') == 'fa fa-plus action-link'){
                                  l++;
                                  $("#viewgrpnumber").text(l); 
                                $(vgId).attr('class','fa fa-check action-link');
                                $("#grpviewTbody").find("#"+vgrowId).attr('class','warning');
                                checkviewgropusrs.push(vgrowId);
                                checkviewgropusrsName.push(vgrowName);  
                                indexgroupview = deleteviewgroupIds.indexOf(vgrowId);
                                console.log('index '+indexgroupview);
                                if(indexgroupview > -1){
                                    deleteviewgroupIds.splice(indexgroupview, 1);
                                }
                                
                            }else if($(vgId).attr('class') == 'fa fa-check action-link'){
                                l--;
                                $("#viewgrpnumber").text(l); 
                                $(vgId).attr('class','fa fa-plus action-link');
                                $("#grpviewTbody").find("#"+vgrowId).attr('class','');
                                indexgroupview = deleteviewgroupIds.indexOf(vgrowId);
                                indexgroupview = deleteviewgroupName.indexOf(vgrowName);
                                console.log('index '+indexgroupview);
                                if(indexgroupview > -1){
                                    deleteviewgroupIds.splice(indexgroupview, 1);
                                    deleteviewgroupName.splice(indexgroupview, 1);
                                    
                                }else{
                                    deleteviewgroupIds.push(vgrowId);
                                    deleteviewgroupName.push(vgrowName);
                                    
                                }   
                                indexgroupview = checkviewgropusrs.indexOf(vgrowId);
                                indexgroupview = checkviewgropusrsName.indexOf(vgrowName);
                                
                                console.log('index '+indexgroupview);
                                if(indexgroupview > -1){
                                    checkviewgropusrs.splice(indexgroupview, 1);
                                    checkviewgropusrsName.splice(indexgroupview, 1);
                                    
                                }   
                            }
                           
                                }
                                
                

                     
    
    
    
                </script>
                
                 
                                            
                                            <div role="tabpanel" class="tab-pane" id="doc_security">
                                                <div class="col-md-12">
                                                    
                                                    
                                                    <apex:outputtext value="{!$Label.Enable_Security}"/>
                                                    
                                                    <c:wiz_slider rendered="true"
                                                                  isActive="{!IF(Document_Profile__c.Enable_Security__c,'active','')}"
                                                                  isEditable="false"
                                                                  FieldId="Enable_Security__c"
                                                                  initvalue="{!Document_Profile__c.Document_type__r.Enable_Security__c}"
                                                                  callbackfunction="showhidesecurity();"
                                                                  
                                                                  />
                                                    
                                                    
                                                    <script type="text/javascript">
                                                    $(function() {
                                                        
                                                        var isedit='{!$CurrentPage.parameters.isedit}';
                                                        if(('{!documentprofile.Status__c}'=='Current' ||'{!documentprofile.Status__c}'=='Expired' || '{!documentprofile.Status__c}'=='Obsolete' )&& !isedit){
                                                            $('#'+'Enable_Security__c_slider').attr('onclick','');
                                                        }
                                                        
                                                        
                                                        if({!Document_profile__c.Enable_Security__c}==true){
                                                            if({!Document_profile__c.Enable_Security__c}==true){
                                                                $('#hideshow').removeClass( "hidden" ).addClass( "wiz-field" );
                                                            }
                                                            else
                                                            {
                                                                $('#hideshow').removeClass( "wiz-field" ).addClass( "hidden" );   
                                                            }
                                                        }
                                                        else{
                                                            if({!Document_profile__c.Document_Type__r.Enable_Security__c}==true)
                                                            {
                                                                $('#hideshow').removeClass( "hidden" ).addClass( "wiz-field" );
                                                            }
                                                            else
                                                            {
                                                                $('#hideshow').removeClass( "wiz-field" ).addClass( "hidden" );
                                                            }
                                                            
                                                        }
                                                        
                                                        
                                                    });
                                                    
                                                    function showhidesecurity(){

                                                     if($('#Enable_Security__c').val()=='true'){
                                                         
                                                        $('#hideshow').removeClass( "wiz-field" ).addClass( "hidden" ); 

                                                     }
                                                     else{
                                                         
                                                        $('#hideshow').removeClass( "hidden" ).addClass( "wiz-field" );

                                                         
                                                     }
                                                 }
                                                    
                                                    </script>
                                                    
                                                   </div>
                                                    <div class="hidden" id="hideshow">
                                                            <div class="wiz-fields-wide col-md-12">
                                                                <div class="form-group"> 
                                                                    <div>
                                                                        <div class="form-group"> 
                                                                            
                                                                            <!-- Nav tabs -->
                                                                            <ul class="nav nav-tabs" role="tablist">
                                                                                <li role="presentation" class="active"><a href="#AuthEntity" aria-controls="AuthEntity" role="tab" data-toggle="tab">Authorised Entity</a></li>
                                                                                <li role="presentation"><a href="#ViewEntity" aria-controls="ViewEntity" role="tab" data-toggle="tab">View Only Entities</a></li>
                                                                            </ul>
                                                                            
                                                                            <!-- Tab panes -->
                                                                            <div class="tab-content">
                                                                                
                                                                                <!-- Authorised pane -->
                                                                                <div role="tabpanel" class="tab-pane active" id="AuthEntity">
                                                                                    <div class="panel-body">
                                                                                        
                                                                                        <!-- Accordion -->
                                                                                        <div class="panel-group" role="tablist">
                                                                                            <div class="form-group">  
                                                                                                <div class="panel panel-default"> 
                                                                                                    <div class="panel-heading" role="tab" data-toggle="collapse" href="#select_auth_user" aria-expanded="true" aria-controls="select_auth_user"> 
                                                                                                        <h4 class="panel-title"> 
                                                                                                            Select Users(<label class="badge"  id ="number"></label> of <span class="badge">{!usercount}</span> Selected) 
                                                                                                        </h4> 
                                                                                                    </div>  
                                                                                                    <div id="select_auth_user" class="panel-collapse collapse " role="tabpanel" aria-labelledby="select_auth_user" aria-expanded="true" style=""> 
                                                                                                        
                                                                                                        <div class="panel-body">
                                                                                                            <p class="text-right">
                                                                                                                <button class="btn btn-sm btn-primary" onclick="allusers();">All</button>
                                                                                                                <button class="btn btn-sm btn-default" onclick="selectedusers();">Selected</button>
                                                                                                                <button class="btn btn-sm btn-default" onclick="unselectedusers();">Non Selected</button>
                                                                                                            </p>
                                                                                                            <table class="table select-users">  
                                                                                                                <tbody id="usrTbody">
                                                                                                                    <tr>
                                                                                                                        <th>Users</th>
                                                                                                                        <th style="width: 100px"><a href="#" onclick="checkall();"> Select All</a></th>
                                                                                                                    </tr>
                                                                                                                    
                                                                                                                    <apex:repeat value="{!userList}" var="usrs" >
                                                                                                                        <tr id="{!JSENCODE(usrs.Id)}" >
                                                                                                                            <td><apex:outputtext value="{!usrs.Name}"/></td>
                                                                                                                            <td><i class="fa fa-plus action-link" onclick="usrsActions(this,'{!JSENCODE(usrs.Id)}','{!JSENCODE(usrs.Name)}');" id="{!JSENCODE(usrs.Id)}_checkids"></i></td>
                                                                                                                        </tr>
                                                                                                                    </apex:repeat>
                                                                                                                    
                                                                                                                </tbody>
                                                                                                            </table>
                                                                                                        </div>
                                                                                                        
                                                                                                        
                                                                                                    </div> 
                                                                                                    
                                                                                                </div> 
                                                                                                <div class="panel panel-default"> 
                                                                                                    <div class="panel-heading" role="tab" data-toggle="collapse" href="#select_auth_userr" aria-expanded="true" aria-controls="select_auth_user"> 
                                                                                                        <h4 class="panel-title"> 
                                                                                                            Select groups(<label class="badge"  id ="grnumber"></label> of <span class="badge">{!groupcount}</span> Selected) 
                                                                                                        </h4> 
                                                                                                    </div>
                                                                                                    
                                                                                                    <div id="select_auth_userr" class="panel-collapse collapse " role="tabpanel" aria-labelledby="select_auth_userr" aria-expanded="true" style=""> 
                                                                                                        
                                                                                                        <div class="panel-body">
                                                                                                            <p class="text-right">
                                                                                                                <button class="btn btn-sm btn-primary" onclick="allusersGrp();">All</button>
                                                                                                                <button class="btn btn-sm btn-default" onclick="selectedusersGrp();">Selected</button>
                                                                                                                <button class="btn btn-sm btn-default" onclick="unselectedusersGrp();">Non Selected</button>
                                                                                                            </p>
                                                                                                            <table class="table select-users">  
                                                                                                                <tbody id="grpTbody">
                                                                                                                    <tr>
                                                                                                                        <th>Users</th>
                                                                                                                        <th style="width: 100px"><a href="#" onclick="checkallgroupGrp();"> Select All</a></th>
                                                                                                                    </tr>
                                                                                                                    
                                                                                                                    <apex:repeat value="{!groupList}" var="usrs" >
                                                                                                                        <tr id="{!JSENCODE(usrs.Id)}" >
                                                                                                                            <td><apex:outputtext value="{!usrs.Name}"/></td>
                                                                                                                            <td><i class="fa fa-plus action-link" onclick="grpsActions(this,'{!JSENCODE(usrs.Id)}','{!JSENCODE(usrs.Name)}');" id="{!JSENCODE(usrs.Id)}_checkgrpids"></i></td>
                                                                                                                        </tr>
                                                                                                                    </apex:repeat>
                                                                                                                    
                                                                                                                </tbody>
                                                                                                            </table>
                                                                                                        </div>
                                                                                                        
                                                                                                        
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>   
                                                                                    </div>
                                                                                </div>
                                                                                
                                                                                
                                                                                <!-- view pane -->
                                                                                <div role="tabpanel" class="tab-pane " id="ViewEntity">
                                                                                    <div class="panel-body">
                                                                                        <div class="panel-group" role="tablist">
                                                                                            <div class="form-group">
                                                                                                <div class="panel panel-default">
                                                                                                    <div class="panel-heading" role="tab" data-toggle="collapse" href="#select_view_user" aria-expanded="true" aria-controls="select_view_user"> 
                                                                                                        <h4 class="panel-title"> 
                                                                                                            Select Users(<label class="badge"  id ="viewnumber"></label> of <span class="badge">{!usercount}</span> Selected) 
                                                                                                        </h4> 
                                                                                                    </div>  
                                                                                                    
                                                                                                    <div id="select_view_user" class="panel-collapse collapse " role="tabpanel" aria-labelledby="select_view_user" aria-expanded="true" style=""> 
                                                                                                        
                                                                                                        <div class="panel-body">
                                                                                                            <p class="text-right">
                                                                                                                <button class="btn btn-sm btn-primary" onclick="allusersView();">All</button>
                                                                                                                <button class="btn btn-sm btn-default" onclick="selectedusersView();">Selected</button>
                                                                                                                <button class="btn btn-sm btn-default" onclick="unselectedusersView();">Non Selected</button>
                                                                                                            </p>
                                                                                                            <table class="table select-users">  
                                                                                                                <tbody id="usrviewTbody">
                                                                                                                    <tr>
                                                                                                                        <th>Users</th>
                                                                                                                        <th style="width: 100px"><a href="#" onclick="checkallView();"> Select All</a></th>
                                                                                                                    </tr>
                                                                                                                    
                                                                                                                    <apex:repeat value="{!userList}" var="usrs" >
                                                                                                                        <tr id="uva{!JSENCODE(usrs.Id)}" >
                                                                                                                            <td><apex:outputtext value="{!usrs.Name}"/></td>
                                                                                                                            <td><i class="fa fa-plus action-link" onclick="usrsviewActions(this,'{!JSENCODE(usrs.Id)}','{!JSENCODE(usrs.Name)}');" id="{!JSENCODE(usrs.Id)}_checkviewids"></i></td>
                                                                                                                        </tr>
                                                                                                                    </apex:repeat>
                                                                                                                    
                                                                                                                </tbody>
                                                                                                            </table>
                                                                                                        </div>
                                                                                                        
                                                                                                        
                                                                                                        
                                                                                                        
                                                                                                    </div>          
                                                                                                    
                                                                                                    
                                                                                                </div>     
                                                                                                
                                                                                                <div class="panel panel-default"> 
                                                                                                    <div class="panel-heading" role="tab" data-toggle="collapse" href="#select_viewgroup_user" aria-expanded="true" aria-controls="select_viewgroup_user"> 
                                                                                                        <h4 class="panel-title"> 
                                                                                                            Select groups(<label class="badge"  id ="viewgrpnumber"></label> of <span class="badge">{!groupcount}</span> Selected) 
                                                                                                        </h4> 
                                                                                                    </div>
                                                                                                    
                                                                                                    <div id="select_viewgroup_user" class="panel-collapse collapse " role="tabpanel" aria-labelledby="select_viewgroup_user" aria-expanded="true" style=""> 
                                                                                                        
                                                                                                        <div class="panel-body">
                                                                                                            <p class="text-right">
                                                                                                                <button class="btn btn-sm btn-primary" onclick="allusersViewGrp();">All</button>
                                                                                                                <button class="btn btn-sm btn-default" onclick="selectedusersViewGrp();">Selected</button>
                                                                                                                <button class="btn btn-sm btn-default" onclick="unselectedusersViewGrp();">Non Selected</button>
                                                                                                            </p>
                                                                                                            <table class="table select-users">  
                                                                                                                <tbody id="grpviewTbody">
                                                                                                                    <tr>
                                                                                                                        <th>Users</th>
                                                                                                                        <th style="width: 100px"><a href="#" onclick="checkallgroupViewGrp();"> Select All</a></th>
                                                                                                                    </tr>
                                                                                                                    
                                                                                                                    <apex:repeat value="{!groupList}" var="usrs" >
                                                                                                                        <tr id="uga{!JSENCODE(usrs.Id)}" >
                                                                                                                            <td><apex:outputtext value="{!usrs.Name}"/></td>
                                                                                                                            <td><i class="fa fa-plus action-link" onclick="viewgrpsActions(this,'{!JSENCODE(usrs.Id)}','{!JSENCODE(usrs.Name)}');" id="{!JSENCODE(usrs.Id)}_checkgrpsids"></i></td>
                                                                                                                        </tr>
                                                                                                                    </apex:repeat>
                                                                                                                    
                                                                                                                </tbody>
                                                                                                            </table>
                                                                                                        </div>
                                                                                                        
                                                                                                        
                                                                                                    </div>
                                                                                                </div>
                                                                                                
                                                                                                
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                
                                                                                
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                    </div>
                                                    
                                                    
 </div>
                                            
                                            <div role="tabpanel" class="tab-pane" id="doc_reference">
                                                <p/><p/>
                                                                                            
                                                <div class="wiz-field"> 
                                                         <div class="wiz-fields-wide col-md-12">
                                                            <div class="form-group"> 
                                                            <div><div class="form-group"> 
                                                    
                                                                  <!-- Nav tabs -->
                                                                  <ul class="nav nav-tabs" role="tablist">
                                                                    <li role="presentation" class="active"><a href="#reference" aria-controls="reference" role="tab" data-toggle="tab">Reference</a></li>
                                                                    <li role="presentation"><a href="#add_ref" aria-controls="add_ref" role="tab" data-toggle="tab">Add Reference</a></li>
                                                                  </ul>
                                                    
                                                                  <!-- Tab panes -->
                                                                  <div class="tab-content">
                                                                    
                                                                    <!-- Reference pane -->
                                                                    <div role="tabpanel" class="tab-pane active" id="reference">
                                                                        
                                                                        <div class="panel-body">
                                                                            <h2>NC</h2>
                                                                            <table class="table table-hover table-condensed">
                                                                                <tbody>
                                                                                    <tr>
                                                                                        <th>{!$ObjectType.Non_Conformance__c.Fields.Name.Label}</th>
                                                                                        <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Type__c.Label}</th>
                                                                                        <th>{!SUBSTITUTE($ObjectType.Non_Conformance__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                                                        <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Source__c.Label}</th>
                                                                                        <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Status__c.Label}</th>
                                                                                        <th></th>
                                                                                    </tr>
                                                                                    <apex:repeat value="{!nonConf}" var="ncon">
                                                                                        <tr id="{!JSENCODE(ncon.id)}">
                                                                                            <td><a href='/{!JSENCODE(ncon.Non_Conformance__c)}'><apex:outputtext value="{!ncon.Non_Conformance__r.Name}"/></a></td>
                                                                                            <td><apex:outputtext value="{!ncon.NC_Type__c}"/></td>
                                                                                            <td><apex:outputtext value="{!ncon.Owner__c}"/></td>
                                                                                            <td><apex:outputtext value="{!ncon.Source__c}"/></td>
                                                                                            <td><apex:outputtext value="{!ncon.Status__c}"/></td>
                                                                                            <td><i class="fa fa-remove" onclick="removeRow('{!JSENCODE(ncon.id)}');"></i></td>
                                                                                        </tr>
                                                                                    
                                                                                    </apex:repeat>
                                                                                </tbody>
                                                                            </table>
                                                    
                                                                            <h2>CAPA</h2>
                                                                            <table class="table table-hover table-condensed">
                                                                                <tbody>
                                                                                    <tr>
                                                                                        <th>{!$ObjectType.CAPA__c.Fields.Name.Label}</th>
                                                                                        <th>{!$ObjectType.CAPA__c.Fields.Title__c.Label}</th>
                                                                                        <th>{!SUBSTITUTE($ObjectType.CAPA__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                                                        <th>{!$ObjectType.CAPA__c.Fields.CAPA_Source__c.Label}</th>
                                                                                        <th>{!$ObjectType.CAPA__c.Fields.CAPA_Status__c.Label}</th>
                                                                                        <th></th>
                                                                                    </tr>
                                                                                    <apex:repeat value="{!capaList}" var="capa">
                                                                                        <tr id="{!JSENCODE(capa.id)}">
                                                                                            <td><a href='/{!JSENCODE(capa.CAPA__c)}'><apex:outputtext value="{!capa.CAPA__r.Name}"/></a></td>
                                                                                            <td><apex:outputtext value="{!capa.Title__c}"/></td>
                                                                                            <td><apex:outputtext value="{!capa.Owner__c}"/></td>
                                                                                            <td><apex:outputtext value="{!capa.Source__c}"/></td>
                                                                                            <td><apex:outputtext value="{!capa.Status__c}"/></td>
                                                                                            <td><i class="fa fa-remove" onclick="removeRow('{!JSENCODE(capa.id)}');"></i></td>
                                                                                        </tr>
                                                                                    
                                                                                   </apex:repeat> 
                                                                                                                                    
                                                                                </tbody>
                                                                            </table>
                                                    
                                                                            <h2>Documents</h2>
                                                                            <table class="table table-hover table-condensed">
                                                                                <tbody id="documentTableTbody">
                                                                                    <tr>
                                                                                        <th>{!$ObjectType.Document_Profile__c.Fields.Name.Label}</th>
                                                                                        <th>{!$ObjectType.Document_Profile__c.Fields.Title__c.Label}</th>
                                                                                        <th>{!$ObjectType.Document_Profile__c.Fields.Current_Rev__c.Label}</th>
                                                                                        <th>{!$ObjectType.Document_Profile__c.Fields.Relation__c.Label}</th>
                                                                                        <th>{!SUBSTITUTE($ObjectType.Document_Profile__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                                                        <th>{!$ObjectType.Document_Profile__c.Fields.Status__c.Label}</th>
                                                                                        <th></th>
                                                                                    </tr>
                                                                                    <apex:repeat value="{!docList}" var="doc">
                                                                                        <tr id="{!JSENCODE(doc.id)}">
                                                                                            <td><a href='/{!JSENCODE(if(doc.DocumentChild__c!=dmid,doc.DocumentChild__c,doc.DocumentParent__c))}'><apex:outputtext value="{!if(doc.DocumentChild__c!=dmid,doc.DocumentChild__r.Name,doc.DocumentParent__r.Name)}"/></a></td>
                                                                                            <td><apex:outputtext value="{!if(doc.DocumentChild__c!=dmid,LEFT(doc.Child_Title__c,20),LEFT(doc.Parent_Title__c,20))}"/></td>
                                                                                            <td><apex:outputtext value="{!if(doc.DocumentChild__c!=dmid,doc.Child_Revision__c,doc.Current_Rev__c)}"/></td>
                                                                                            <td><apex:outputtext value="{!if(doc.DocumentChild__c!=dmid,doc.RelationWithParent__c,doc.RelationWithChild__c)}"/></td>
                                                                                            <td><apex:outputtext value="{!if(doc.DocumentChild__c!=dmid,doc.Child_Owner__c,doc.Parent_Owner__c)}"/></td>
                                                                                            <td id="{!JSENCODE(doc.id)}_status"><apex:outputtext value="{!if(doc.DocumentChild__c!=dmid,doc.Child_Status__c,doc.Parent_Status__c)}"/></td>
                                                                                            <td><i class="fa fa-remove" onclick="removeRow('{!JSENCODE(doc.id)}');"></i></td>
                                                                                        </tr>
                                                                                   </apex:repeat>
                                                                                
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                    <!-- Reference pane -->
                                                                    
                                                                    <!-- Add Reference -->
                                                                    <div role="tabpanel" class="tab-pane" id="add_ref">
                                                                        <div class="panel-body">
                                                
                                                                            <apex:form id="f1">
                                                                                <div class="form-group" id="stexts">
                                                                                    <label for="exampleInputEmail1">Search (You can search NC/CAPA/DOC Number, Source, Type, Status, Owner Name)</label>
                                                                                    <apex:inputtext id="input" value="{!search}" styleclass="form-control" html-placeholder="(You can search NC/CAPA/DOC Number, Source, Type, Status, Owner Name)" disabled="{!AND(ISBLANK($CurrentPage.parameters.isedit),documentProfile.Status__c!='Draft',documentProfile.Status__c!='Void',documentProfile.Status__c!='Expired')}"/>
                                                                                </div>
                                                                                <div class="form-group checkbox-list">
                                                                                    
                                                                                    <div class="row col-md-12">
                                                                                        <script>
                                                                                        function checkAll(allChkbox){
                                                                                            console.log('checkAll   '+$(allChkbox).is(":checked"));
                                                                                            $('.oneCheckbox').prop('checked',$(allChkbox).is(":checked"));
                                                                                            
                                                                                        }
                                                                                        function singleCheck(){
                                                                                            if($(".oneCheckbox").length == $(".oneCheckbox:checked").length) {
                                                                                                $(".allCheckbox").prop("checked", "checked");
                                                                                            }else{
                                                                                                $(".allCheckbox").removeAttr("checked");
                                                                                            }
                                                                                        }
                                                                                        </script>
                                                                                        
                                                                                            <table>
                                                                                                <tr>
                                                                                                    <td>
                                                                                                        <label><apex:inputCheckbox id="allCheckbox" label="All" value="{!allCheck}" onclick="checkAll(this);" styleClass="allCheckbox" disabled="{!AND(ISBLANK($CurrentPage.parameters.isedit),documentProfile.Status__c!='Draft',documentProfile.Status__c!='Void',documentProfile.Status__c!='Expired')}"/> All &nbsp; </label>
                                                                                                    </td>
                                                                                                    <td>
                                                                                                        <label><apex:inputCheckbox id="ncCheckbox" label="NC" value="{!ncCheck}" styleClass="oneCheckbox" onclick="singleCheck();" disabled="{!AND(ISBLANK($CurrentPage.parameters.isedit),documentProfile.Status__c!='Draft',documentProfile.Status__c!='Void',documentProfile.Status__c!='Expired')}"/> NC &nbsp; </label>
                                                                                                    </td>
                                                                                                    <td>
                                                                                                        <label><apex:inputCheckbox id="capaCheckbox" label="CAPA" value="{!capaCheck}" styleClass="oneCheckbox" onclick="singleCheck();" disabled="{!AND(ISBLANK($CurrentPage.parameters.isedit),documentProfile.Status__c!='Draft',documentProfile.Status__c!='Void',documentProfile.Status__c!='Expired')}"/> CAPA &nbsp; </label>
                                                                                                    </td>
                                                                                                    <td>
                                                                                                        <label><apex:inputCheckbox id="docCheckbox" label="DOC" value="{!docCheck}" styleClass="oneCheckbox" onclick="singleCheck();" disabled="{!AND(ISBLANK($CurrentPage.parameters.isedit),documentProfile.Status__c!='Draft',documentProfile.Status__c!='Void',documentProfile.Status__c!='Expired')}"/> DOC &nbsp; </label>
                                                                                                    </td>
                                                                                                </tr>
                                                                                            </table>
                                                                                        
                                                                                    </div>
                                                                                    <div class="clearfix"></div>
                                                                                         
                                                                                </div>
                                                                                <div>
                                                                                    <p class="bg-danger search-hint">Select modules you want to search into</p>
                                                                                    <apex:commandButton value="Search" action="{!doSearch}" styleClass="btn btn-primary" reRender="nccapadoc" onclick="validSearch();" oncomplete="checkList();" disabled="{!AND(ISBLANK($CurrentPage.parameters.isedit),documentProfile.Status__c!='Draft',documentProfile.Status__c!='Void',documentProfile.Status__c!='Expired')}">
                                                                                        <apex:actionSupport oncomplete="{!allCheck}" ></apex:actionSupport>
                                                                                        <apex:actionSupport oncomplete="{!ncCheck}"></apex:actionSupport>
                                                                                        <apex:actionSupport oncomplete="{!capaCheck}"></apex:actionSupport>
                                                                                        <apex:actionSupport oncomplete="{!docCheck}"></apex:actionSupport>
                                                                                    </apex:commandButton>
                                                                                    
                                                                                    <script>
                                                                                        function validSearch(){
                                                                                            var search= $("[id$='input']").val().trim();
                                                                                            if(search==null || search=='' || search.length < 0){
                                                                                                showDialog('1',"Enter Some Text");
                                                                                            }
                                                                                        }
                                                                                    </script>
                                                                                </div>
                                                                                <br/>
                                                                                <br/>
                                                                            </apex:form>
                                                                            <apex:pageBlock id="nccapadoc">
                                                                                <h2>NC</h2>
                                                                                
                                                                                    <script type="text/javascript">
                                                                                        function checkList(flag){
                                                                                            <apex:repeat value="{!allNCs}" var="ncObj"> =='{!ncObj.Name}'
                                                                                                <apex:repeat value="{!nonConf}" var="nconf">
                                                                                                    if(flag){
                                                                                                        if('{!JSENCODE(ncObj.id)}' == '{!JSENCODE(nconf.id)}'){ 
                                                                                                            $('#ncTbody').find({!JSENCODE(ncObj.id)}).attr('class','danger');
                                                                                                        }
                                                                                                    }else{ 
                                                                                                        if('{!JSENCODE(ncObj.id)}' == '{!JSENCODE(nconf.id)}'){ 
                                                                                                            $('#ncTbody').find('{!JSENCODE(nconf.id)}').find('td').eq(5).find('i').attr('class','fa fa-remove action-link');
                                                                                                            $('#ncTbody').find('{!JSENCODE(ncObj.id)}').attr('class','danger');
                                                                                                        }
                                                                                                    }
                                                                                                </apex:repeat>
                                                                                            </apex:repeat>
                                                                                            
                                                                                            <apex:repeat value="{!allCAPAs}" var="capaObj">
                                                                                                <apex:repeat value="{!capaList}" var="cList">
                                                                                                    if(flag){
                                                                                                        if('{!JSENCODE(capaObj.id)}' == '{!JSENCODE(cList.id)}'){ 
                                                                                                            $('#capaTbody').find({!JSENCODE(capaObj.id)}).attr('class','danger');
                                                                                                        }
                                                                                                    }else{
                                                                                                        if('{!JSENCODE(capaObj.id)}' == '{!JSENCODE(cList.id)}'){ 
                                                                                                            $('#capaTbody').find('{!JSENCODE(cList.id)}').find('td').eq(5).find('i').attr('class','fa fa-remove action-link');
                                                                                                            $('#capaTbody').find('{!JSENCODE(capaObj.id)}').attr('class','danger');
                                                                                                        }
                                                                                                    }
                                                                                                </apex:repeat>
                                                                                            </apex:repeat>
                                                                                            
                                                                                        }
                                                                                        
                                                                                        
                                                                                    </script>
                                                                                
                                                                                    <table class="table table-hover table-condensed">
                                                                                        <tbody id="ncTbody">
                                                                                            <tr>
                                                                                                <th>{!$ObjectType.Non_Conformance__c.Fields.Name.Label}</th>
                                                                                                <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Type__c.Label}</th>
                                                                                                <th>{!SUBSTITUTE($ObjectType.Non_Conformance__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                                                                <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Source__c.Label}</th>
                                                                                                <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Status__c.Label}</th>
                                                                                            </tr>
                                                                                            <apex:repeat value="{!allNCs}" var="ncs">
                                                                                                <tr id="{!JSENCODE(ncs.Id)}">
                                                                                                    <td><apex:outputtext value="{!ncs.Name}"/></td>
                                                                                                    <td><apex:outputtext value="{!ncs.NC_Type__c}"/></td>
                                                                                                    <td><apex:outputtext value="{!ncs.Owner.Name}"/></td>
                                                                                                    <td><apex:outputtext value="{!ncs.NC_Source__c}"/></td>
                                                                                                    <td><apex:outputtext value="{!ncs.NC_Status__c}"/></td>
                                                                                                    <td><i class="fa fa-plus action-link" onclick="ncActions(this,'{!JSENCODE(ncs.Id)}');"></i></td>
                                                                                                    
                                                                                                </tr>
                                                                                             </apex:repeat>                                                                                                         
                                                                                        </tbody>
                                                                                    </table>
                                                        
                                                                                    <h2>CAPA</h2>
                                                                                    <table class="table table-hover table-condensed">
                                                                                        <tbody id="capaTbody">
                                                                                            <tr>
                                                                                                <th>{!$ObjectType.CAPA__c.Fields.Name.Label}</th>
                                                                                                <th>{!$ObjectType.CAPA__c.Fields.Title__c.Label}</th>
                                                                                                <th>{!SUBSTITUTE($ObjectType.CAPA__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                                                                <th>{!$ObjectType.CAPA__c.Fields.CAPA_Source__c.Label}</th>
                                                                                                <th>{!$ObjectType.CAPA__c.Fields.CAPA_Status__c.Label}</th>
                                                                                            </tr>
                                                                                            <apex:repeat value="{!allCAPAs}" var="capas">
                                                                          
                                                                                                <tr id="{!JSENCODE(capas.Id)}">
                                                                                                    <td><apex:outputtext value="{!capas.Name}"/></td>
                                                                                                    <td><apex:outputtext value="{!capas.Title__c}"/></td>
                                                                                                    <td><apex:outputtext value="{!capas.Owner.Name}"/></td>
                                                                                                    <td><apex:outputtext value="{!capas.CAPA_Source__c}"/></td>
                                                                                                    <td><apex:outputtext value="{!capas.CAPA_Status__c}"/></td>
                                                                                                    <td><i class="fa fa-plus action-link" onclick="capaActions(this,'{!JSENCODE(capas.Id)}');"></i></td>
                                                                                                </tr>
                                                                                                 
                                                                                            </apex:repeat>
                                                                                        
                                                                                        </tbody>
                                                                                    </table>
                                                                                    
                                                                                    <h2>Documents</h2>
                                                                                    <table class="table table-hover table-condensed">
                                                                                        <tbody id="docTbody">
                                                                                            <tr>
                                                                                                <th>{!$ObjectType.Document_Profile__c.Fields.Name.Label}</th>
                                                                                                <th>{!$ObjectType.Document_Profile__c.Fields.Title__c.Label}</th>
                                                                                                <th>{!$ObjectType.Document_Profile__c.Fields.Current_Rev__c.Label}</th>
                                                                                                <th>{!$ObjectType.Document_Profile__c.Fields.Relation__c.Label}</th>
                                                                                                <th>{!SUBSTITUTE($ObjectType.Document_Profile__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                                                                <th>{!$ObjectType.Document_Profile__c.Fields.Status__c.Label}</th>
                                                                                            </tr>
                                                                                            <apex:repeat value="{!allDocs}" var="docs">
                                                                                                <tr id="{!JSENCODE(docs.Id)}">
                                                                                                    <td><apex:outputtext value="{!docs.Name}"/></td>
                                                                                                    <td><apex:outputtext value="{!LEFT(docs.Title__c,20)}"/></td>
                                                                                                    <td><apex:outputtext value="{!docs.Current_Rev__c}"/></td>
                                                                                                    <td><select id="{!JSENCODE(docs.Id)}_Select" onchange="selectRelation(this,'{!JSENCODE(docs.Id)}')"><option value="Related">Related</option>
                                                                                                    <option value="Sub Document">Sub Document</option>
                                                                                                    <option value="Master">Master</option>
                                                                                                    </select></td>
                                                                                                    <td><apex:outputtext value="{!docs.Owner.Name}"/></td>
                                                                                                    <td><apex:outputtext value="{!docs.Status__c}"/></td>
                                                                                                    <td><i class="fa fa-plus action-link" onclick="docActions(this,'{!JSENCODE(docs.Id)}');"></i></td>
                                                                                                </tr>
                                                                                                 
                                                                                            </apex:repeat>
                                                                                        
                                                                                        </tbody>
                                                                                    </table>
                                                                                </apex:pageBlock>
                                                                            </div>
                                                                        </div>
                                                                    <!-- Add Reference -->
                                                
                                                                  </div>
                                                
                                                                </div></div>
                                                          
                                                      </div></div>
                                                </div>
                                            </div>
                                            
                                            <!--<div role="tabpanel" class="tab-pane" id="doc_revision_history">
</div>-->
                                            <div role="tabpanel" class="tab-pane" id="doc_change_requests">
                                                
                                              
                                                <apex:outputpanel layout="none" rendered="{!documentProfile.Status__c=='Current'}">
                                                <div class="button-bar text-right">
                                                    <button id="" class="btn btn-primary" type="button" onclick="changerequest();">Create Change Request</button>
                                                </div>
                                                </apex:outputpanel>
                                                <div class="col-md-12">
                                                    
                                                    <table class="table table-hover">
                                                        
                                                        <tbody>
                                                            
                                                            <tr>
                                                                
                                                                <th>{!$ObjectType.Change_Management__c.Fields.Name.Label}</th>
                                                                <th>{!$ObjectType.Change_Management__c.Fields.Title__c.Label}</th>
                                                                <th> {!$ObjectType.Document_Profile__c.Fields.Name.Label}(rev)</th>
                                                                <th>Owner</th>
                                                                <th>Created Date</th> 
                                                                <th>{!$ObjectType.Change_Management__c.Fields.Status__c.Label}</th>
                                                                
                                                                
                                                            </tr>
                                                            
                                                            <apex:repeat value="{!CmList}" var="chreq">
                                                                <tr id="{!JSENCODE(chreq.Id)}">
                                                                    <td><a href='/{!JSENCODE(chreq.id)}'> {!JSENCODE(chreq.name)} </a></td>
                                                                    <td> {!JSENCODE(chreq.Title__c)} </td>
                                                                     <td> {!JSENCODE(documentprofile.Name)}({!JSENCODE(chreq.Current_Revision__c)}) </td>
                                                                    <td> {!JSENCODE(chreq.Owner.Name)} </td>
                                                                    <td>  
                                                                        <apex:outputText value="{0,date,dd'/'MM'/'yyyy}" >
                                                                            <apex:param value="{!chreq.CreatedDate}"/>
                                                                        </apex:outputText></td>
                                                                    
                                                                    
                                                                    <td> {!JSENCODE(chreq.Status__c)} </td>
                                                                    
                                                                </tr>   
                                                            </apex:repeat>
                                                            
                                                            
                                                            
                                                        </tbody>
                                                    </table>
                                                    
                                                    
                                                </div>
                                                
                                                
                                                
                                            </div>
                                        </div>
                                        
                                    </div><!-- Sub Tabs -->
                                    
                          
                        </div>
                    </div>
                </apex:outputPanel>
                
                <!--v1.3 --Document Profile Approval -->
                <apex:outputPanel rendered="{!(JSENCODE($CurrentPage.parameters.pg)=='doc_Approval')}">                    
                    <c:wiz_form RecordId="{!DocumentProfile.id}" formclass="DocProfile validate" formid="DocProfile"  submitpage="stringify_sobject" recordid="" postsavejs="SubmitDocApprovalProcess();">
                        <input type="hidden" name="sobj" value="Document_Profile__c" />
                        <input type="hidden" name="page" id="page" value="doc_Approval" /> 
                        <input type="hidden" id="stepName" name="stepName" value="Approval" />
                        <input type="hidden" name="Id" value="{!documentProfile.Id}" />
                        <input type="hidden" name="{!IF(NOT(ISBLANK(Prefix)),Prefix+'__Submit__c','Submit__c')}" id="DocDetailsSubmit" value="Save" />
                        <input type="hidden" name="{!IF(NOT(ISBLANK(Prefix)),Prefix+'__Approval_Required__c','Approval_Required__c')}" id="DocDetailsSubmit" value="false" />                        
                        <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Document_Approval}" var="f">
                            <c:wiz_field Wide="{!OR($ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].type=='multipicklist',f==IF(NOT(ISBLANK(Prefix)),Prefix+'__Title__c','Title__c'))}"
                                         FieldLabel="{!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}"
                                         required="{!f.required}" jsid="{!LEFT(f,LEN(f)-3)}"
                                         rendered="{!$ObjectType.Document_Profile__c.Fields[f].Accessible}">
                                <div class="clearfix"></div>
                                <c:wiz_input rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='string'}"
                                             fieldId="{!f}" fieldname="{!f}"
                                             type="{!if($ObjectType.Document_Profile__c.Fields[f].type=='double','number','text')}" maxlength="{!if($ObjectType.Document_Profile__c.Fields[f].type=='double',$ObjectType.Document_Profile__c.Fields[f].precision,$ObjectType.Document_Profile__c.Fields[f].length)}"
                                             initvalue="{!documentProfile[f]}" required="{!f.required}"
                                             disabled="{!OR(OR(documentProfile.Submit__c=='Submit',documentProfile.Approval_Status__c=='Pending Approval'),OR(NOT($ObjectType.Document_Profile__c.Fields[f].updateable)))}"></c:wiz_input>
                                
                                
                                <c:wiz_richtext rendered="{!AND(NOT(OR(documentProfile.Submit__c=='Submit',documentProfile.Approval_Status__c=='Pending Approval')),$ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].htmlFormatted,NOT(OR(NOT($ObjectType.Document_Profile__c.Fields[f].updateable))))}"
                                                FieldId="{!f}" FieldName="{!f}"
                                                initvalue="{!documentProfile[f]}" Required="{!f.required}" maxlength="4000"></c:wiz_richtext>
                                <apex:outputpanel rendered="{!AND(OR(documentProfile.Submit__c=='Submit',documentProfile.Approval_Status__c=='Pending Approval'),$ObjectType.Document_Profile__c.Fields[f].type=='textarea',$ObjectType.Document_Profile__c.Fields[f].htmlFormatted,OR(NOT($ObjectType.Document_Profile__c.Fields[f].updateable)))}">
                                    <div class="alert alert-info">
                                        <apex:outputField value="{!documentProfile[f]}" />
                                    </div>
                                </apex:outputpanel>
                                <c:wiz_date rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='date'}"
                                            FieldId="{!f}" required="{!if(f.required,'','none')}none"
                                            FieldName="{!f}" initdate="{!documentProfile[f]}"
                                            updateable="{!AND(OR(documentProfile.Submit__c=='Submit',documentProfile.Approval_Status__c=='Pending Approval'),NOT(OR(NOT($ObjectType.Document_Profile__c.Fields[f].updateable))))}">
                                </c:wiz_date>
                                <c:wiz_textarea rendered="{!AND(NOT(OR(documentProfile.Submit__c=='Submit',documentProfile.Approval_Status__c=='Pending Approval')),$ObjectType.Document_Profile__c.Fields[f].type=='textarea',NOT($ObjectType.Document_Profile__c.Fields[f].htmlFormatted),NOT(OR(NOT($ObjectType.Document_Profile__c.Fields[f].updateable))))}"
                                                ObjectName="{!$ObjectType.Document_Profile__c.name}"
                                                FieldId="{!f}" FieldName="{!f}"
                                                initvalue="{!documentProfile[f]}" Required="{!f.required}"></c:wiz_textarea>
                                <apex:outputpanel rendered="{!AND(OR(documentProfile.Submit__c=='Submit',documentProfile.Approval_Status__c=='Pending Approval'),$ObjectType.Document_Profile__c.Fields[f].type=='textarea',NOT($ObjectType.Document_Profile__c.Fields[f].htmlFormatted),OR(NOT($ObjectType.Document_Profile__c.Fields[f].updateable)))}">
                                    <div class="alert alert-info">
                                        <apex:outputField value="{!documentProfile[f]}" />
                                    </div>
                                </apex:outputpanel>
                                <c:wiz_multi width="100%"
                                             onchange="onchangedocumentprofilelookup(this)"
                                             rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}"
                                             required="{!f.required}" FieldId="{!f}" multiple="false"
                                             queryFields="{!IF(f=='Document_Type__c','Title__c,Name','Title__c')}"
                                             querytable="{!IF(f=='OwnerId','User',$ObjectType.Document_Profile__c.Fields[f].referenceTo[0])}"
                                             initvalues="{value: '{!JSENCODE(documentProfile[f])}', label:'{!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}'}"
                                             disabled="{!OR(OR(documentProfile.Submit__c=='Submit',documentProfile.Approval_Status__c=='Pending Approval'),NOT($ObjectType.Document_Profile__c.Fields[f].updateable))}">
                                </c:wiz_multi>
                                <c:wiz_select ObjectName="{!IF(NOT(ISBLANK(Prefix)),Prefix+'__','')}Document_Profile__c"
                                              developername="{!f}" onChangeFunction="" width="100%"
                                              rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='picklist'}"
                                              FieldId="{!f}" FieldName="{!f}"
                                              initvalue="{!documentProfile[f]}"
                                              unSelectedDisplayText="   " Required="{!f.required}"
                                              disabled="{!OR(OR(documentProfile.Submit__c=='Submit',documentProfile.Approval_Status__c=='Pending Approval'),NOT($ObjectType.Document_Profile__c.Fields[f].updateable))}"></c:wiz_select>
                                <apex:outputPanel rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type=='multipicklist')}">
                                    
                                    <select id="{!f}" name="{!f}" class="form-control"
                                            multiple="multiple" style="width: 100%;"></select>
                                    
                                    
                                </apex:outputPanel>
                            </c:wiz_field>
                        </apex:repeat>
                    </c:wiz_form>
                    <c:wiz_validator onValid="" ignorehidden=""></c:wiz_validator>
                    <c:wiz_form FormClass="DocumentProfileapproval validate" FormId="DocumentProfileapproval" RecordId="" submitPage="">
                        
                        <c:wizard_approval disabled="{!OR(documentProfile.Status__c!='Draft',documentProfile.Approval_Status__c=='Pending Approval')}"
                                           isLocked="{!OR(documentProfile.Status__c=='Pending Approval',documentProfile.Status__c=='Void',NOT(OR(documentProfile.OwnerId=$User.Id,documentProfile.Ownerid==$User.Id,$Profile.Name=='System Administrator')),documentProfile.Status__c == 'Closed')}"
                                           allowDaysFieldId="allAllowed_Days__c"
                                           isSubmitForApproval="true"
                                           dueDateFieldId="allDue_Date__c"
                                           taskId="{!documentProfile.id}"
                                           seqFieldId="seqFieldId"
                                           tableId="tableId"
                                           crDate="{!documentProfile.CreatedDate}"
                                           id="approvalid"
                                           isApproverNoteNeeded="true" 
                                           userFieldId="userFieldId"
                                           rendered="{!NOT(AND(NOT(documentProfile.Approval_Required__c),OR(documentProfile.Status__c=='Pending Approval',documentProfile.Approval_Status__c=='Pending',documentProfile.Status__c=='Closed',documentProfile.Status__c=='Void',NOT(OR(documentProfile.OwnerId=$User.Id,documentProfile.Ownerid==$User.Id,$Profile.Name=='System Administrator')),documentProfile.Status__c=='Pending ActionPlan')))}"
                                           noteToApprover="{!documentProfile.Note_To_Approver__c}"
                                           typeofapprover="Document_Approvers" jsid="Doc"
                                           isReloadNeeded="true"
                                           initjs="
                                                   if({!(documentProfile.Approval_Required__c)}){
                                                   $('#tableId_div').removeClass('hidden'); 
                                                   $('#tableId_link').removeClass('hidden');$('#tableId_chk').attr('checked', true);                
                                                   $('#tableId_table').find('input,select').each(function(){
                                                   $(this).attr('disabled', false);   
                                                   });
                                                   } 
                                                   else{
                                                   $('#tableId_div').addClass('hidden'); 
                                                   $('#tableId_link').addClass('hidden');
                                                   $('#tableId_chk').attr('checked', false); 
                                                   }"
                                           /> 
                        
                    </c:wiz_form>
                    <apex:outputPanel rendered="{!NOT(documentProfile.Approval_Required__c) && OR(documentProfile.Status__c=='Closed',documentProfile.Approval_Status__c=='Pending',documentProfile.Status__c=='Void',NOT(OR(documentProfile.OwnerId=$User.Id,documentProfile.Ownerid==$User.Id,$Profile.Name=='System Administrator')),documentProfile.Status__c=='Pending ActionPlan',documentProfile.Status__c=='Pending Approval')}" >
                        <div class="col-md-12"> &nbsp;&nbsp;&nbsp; <input  type="checkbox" value="Yes" disabled="true"/> Approval Required? </div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!if(documentProfile.Approval_Status__c=='Pending',false,true)}">
                        <apex:outputPanel rendered="{!AND(OR($User.Id==documentProfile.Approver__c,$User.Id==documentProfile.Approver_1__c,$User.Id==documentProfile.Approver_2__c,$User.Id==documentProfile.Approver_3__c,$User.Id==documentProfile.Approver_4__c,$User.Id==documentProfile.Approver_5__c,$User.Id==documentProfile.Approver_6__c,$User.Id==documentProfile.Approver_7__c,$User.Id==documentProfile.Approver_8__c,$User.Id==documentProfile.Approver_9__c),documentProfile.Status__c=='Pending Approval')}">                                           
                            <div class="form-group id='Note_To_Approver__c' col-md-12">   
                                <label >{!$ObjectType.document_Profile__c.Fields.Note_To_Approver__c.Label}:
                                </label>
                                <div class="alert alert-info"> <apex:outputField value="{!documentProfile.Note_To_Approver__c}" /> </div>
                            </div>
                        </apex:outputPanel>
                    </apex:outputPanel>
                    <c:wiz_approvalbutton approvalbuttonid="ApprovaButtonIdNcContainment" jsid="javascriptidForApprovalbutton" RecordId="{!documentProfile.id}"></c:wiz_approvalbutton>
                    
                </apex:outputPanel>
                <!--v1.3   Document Profile Approval start-->
                
                <!----Details--->
                <apex:outputPanel rendered="{!$CurrentPage.parameters.pg=='doc_Details'}">
                    <input type="hidden" name="page" id="page" value="doc_Details"/>
                    <input type="hidden" id="stepName" name="stepName" value="doc_Details" />
                    
                    <h1><apex:outputText value="{!$Label.Document_Initiation}"/></h1>  <!-- make value dynamic here -->
                    
                    <table class="table table-responsive table-bordered">
                        <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Initiation_Fields}"
                                     var="f">
                            <tr>
                                <td class="title-col">
                                    {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                </td>
                                <td>
                                    <apex:outputPanel rendered="{!f!='Document_Type__c'}">
                                        <apex:outputField value="{!documentProfile[f]}"/> 
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!f=='Document_Type__c'}">
                                        <apex:outputField value="{!documentProfile.Document_Type__r.Title__c}"/>
                                        (<apex:outputField value="{!documentProfile[f]}"/> )
                                    </apex:outputPanel>
                                </td>
                            </tr>
                        </apex:repeat>                    
                    </table>
                    
                    <!-----------------custom fileds---------------------------------->
                    <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.FieldSets.Document_Profile_Custom_Fields.size!=0}">
                        <h1><apex:outputText value="Custom Fields" /></h1>
                        <table class="table table-responsive table-bordered">
                            <tbody>
                                <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Document_Profile_Custom_Fields}" var="f">
                                    <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].Accessible}">
                                        <tr>
                                            <td class="title-col">
                                                {!$ObjectType.Document_Profile__c.Fields[f].label}
                                            </td>
                                            <td>
                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='textarea'}">
                                                    <div class="alert alert-info"> <apex:outputField value="{!documentProfile[f]}" /> </div>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='date'}">
                                                    <apex:outputText value="{0,date, dd MMMM yyyy}"> 
                                                        <apex:param value="{!documentProfile[f]}"/>
                                                    </apex:outputText>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!NOT(OR($ObjectType.Document_Profile__c.Fields[f].type=='date',$ObjectType.Document_Profile__c.Fields[f].type=='reference',$ObjectType.Document_Profile__c.Fields[f].type=='textarea'))}">
                                                    {!JSENCODE(documentProfile[f])}
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}">
                                                    {!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}
                                                </apex:outputPanel>
                                            </td>
                                        </tr>                                
                                    </apex:outputPanel>  
                                </apex:repeat>
                            </tbody>
                        </table>
                    </apex:outputPanel> 
                    <!------------------------------------------------------>
                    
                    <div class="panel-group screen-only" id="accordion" role="tablist" aria-multiselectable="true">
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="headingDPInformation">
                                <h4 class="panel-title">
                                    <a class="btn btn-link btn-xs pull-right" data-toggle="collapse" data-parent="#accordion" href="#collapseDPInformation" aria-expanded="true" aria-controls="collapseCMResolutionCode">
                                        <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>
                                    </a>                            
                                    
                                    
                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseDPInformation" aria-expanded="true" aria-controls="collapseDPInformation">
                                        Document Information
                                    </a>
                                </h4> 
                            </div> 
                            
                            <div id="collapseDPInformation" class="panel-collapse collapse out" role="tabpanel" aria-labelledby="headingDPInformation">
                                <div class="panel-body">                        
                                    <div class="add-contain-wrapper added-containment-action screen-only">
                                        <div class="add-containment">   
                                            
                                            
                                            
                                            <table class="table table-responsive table-bordered">
                                                <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.DocumentEditLayout}"
                                                             var="f">
                                                    <tr>
                                                        <td class="title-col">
                                                            {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                                        </td>
                                                        <td>
                                                            <apex:outputPanel rendered="{!f!=IF(NOT(ISBLANK(Prefix)),Prefix+'__Impacted_Sites__c','Impacted_Sites__c')}">
                                                                <apex:outputField value="{!documentProfile[f]}"/> 
                                                            </apex:outputPanel>
                                                            <apex:outputPanel rendered="{!f==IF(NOT(ISBLANK(Prefix)),Prefix+'__Impacted_Sites__c','Impacted_Sites__c')}">
                                                                <div class="col-md-12">
                                                                    <c:wiz_multi width="100%"
                                                                                 required="{!f.required}"
                                                                                 FieldId="{!f}"
                                                                                 multiple="true"
                                                                                 FieldName="{!f}"
                                                                                 queryFields="Name"
                                                                                 querytable="{!IF(NOT(ISBLANK(Prefix)),Prefix+'__','')}Manufacturing_Site__c"
                                                                                 dataid=""                                      
                                                                                 disabled="true">
                                                                        <apex:repeat value="{!ImpactedSites}" var="impatedsite">
                                                                            <option selected="selected" value="{!JSENCODE(impatedsite.id)}">{!JSENCODE(impatedsite.Name)}</option>
                                                                        </apex:repeat>
                                                                    </c:wiz_multi>                     
                                                                </div>
                                                                
                                                                <!-- initvalues="{value: '{!JSENCODE(documentProfile[f])}', label:'{!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}'}"-->                       
                                                            </apex:outputPanel>
                                                        </td>
                                                    </tr>
                                                </apex:repeat>                  
                                            </table>
                                            
                                            <h1><apex:outputText value="Document Setup" /></h1> 
                                            
                                            <table class="table table-responsive table-bordered">
                                                <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Document_Setup}"
                                                             var="f">
                                                    <tr>
                                                        <td class="title-col">
                                                            {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                                        </td>
                                                        <td>
                                                            <apex:outputField value="{!documentProfile[f]}"/> 
                                                        </td>
                                                    </tr>
                                                </apex:repeat>                    
                                            </table>
                                            
                                            <!--<h1><apex:outputText value="Watermark Section" /></h1> 
                                            
                                            <table class="table table-responsive table-bordered">
                                                <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Watermark_Section}"
                                                             var="f">
                                                    <tr>
                                                        <td class="title-col">
                                                            {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                                        </td>
                                                        <td>
                                                            <apex:outputField value="{!documentProfile[f]}"/> 
                                                        </td>
                                                    </tr>
                                                </apex:repeat>                    
                                            </table>-->
                                            
                                            <h1><apex:outputText value="Document Content" /></h1> 
                                            
                                            <table class="table table-responsive table-bordered">
                                                <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Document_Content}"
                                                             var="f">
                                                    <tr>
                                                        <td class="title-col">
                                                            {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                                        </td>
                                                        <td>
                                                            <apex:outputField value="{!documentProfile[f]}"/> 
                                                        </td>
                                                    </tr>
                                                </apex:repeat>                    
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <!------------------------------------------------------>
                    
                    <div class="panel-group screen-only" id="accordion" role="tablist" aria-multiselectable="true">
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="headingSecurity">
                                <h4 class="panel-title">
                                    <a class="btn btn-link btn-xs pull-right" data-toggle="collapse" data-parent="#accordion" href="#collapseSecurity" aria-expanded="true" aria-controls="collapseSecurity">
                                        <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>
                                    </a>                            
                                    
                                    
                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseSecurity" aria-expanded="true" aria-controls="collapseSecurity">
                                        Security
                                    </a>
                                </h4> 
                            </div> 
                            
                            <div id="collapseSecurity" class="panel-collapse collapse out" role="tabpanel" aria-labelledby="headingSecurity">
                                <div class="panel-body">                        
                                    <div class="add-contain-wrapper added-containment-action screen-only">
                                        <div class="add-containment">   
                                            
                                        <table class="table table-responsive table-bordered">
                                            <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Security_Fields}"
                                                         var="f">
                                                <tr>
                                                    <td class="title-col">
                                                        {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                                    </td>
                                                    <td>
                                                        <apex:outputField value="{!Document_Profile__c[f]}"/>
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!------------------------------------------------------>
                    
                      <!------------------------------------------------------>
                    
                    <div class="panel-group screen-only" id="accordion" role="tablist" aria-multiselectable="true">
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="headingCRS">
                                <h4 class="panel-title">
                                    <a class="btn btn-link btn-xs pull-right" data-toggle="collapse" data-parent="#accordion" href="#collapseCRS" aria-expanded="true" aria-controls="collapseSecurity">
                                        <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>
                                    </a>                            
                                    
                                    
                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseCRS" aria-expanded="true" aria-controls="collapseCRS">
                                        Change Requests
                                    </a>
                                </h4> 
                            </div> 
                            
                            <div id="collapseCRS" class="panel-collapse collapse out" role="tabpanel" aria-labelledby="headingCRS">
                                <div class="panel-body">                        
                                    <div class="add-contain-wrapper added-containment-action screen-only">
                                        <div class="add-containment">   
                                            
                                             <table class="table table-hover">
                                                        
                                                       <tbody>
                                                            
                                                            <tr>
                                                                
                                                                <th>{!$ObjectType.Change_Management__c.Fields.Name.Label}</th>
                                                                <th>{!$ObjectType.Change_Management__c.Fields.Title__c.Label}</th>
                                                                <th> Originated from</th>
                                                                <th>Owner</th>
                                                                <th>Created Date</th> 
                                                                <th>{!$ObjectType.Change_Management__c.Fields.Status__c.Label}</th>
                                                                
                                                                
                                                            </tr>
                                                            
                                                            <apex:repeat value="{!CmList}" var="chreq">
                                                                <tr id="{!JSENCODE(chreq.Id)}">
                                                                    <td><a href='/{!JSENCODE(chreq.id)}'> {!JSENCODE(chreq.name)} </a></td>
                                                                    <td> {!JSENCODE(chreq.Title__c)} </td>
                                                                     <td> {!JSENCODE(chreq.Name)}({!JSENCODE(chreq.Current_Revision__c)}) </td>
                                                                    <td> {!JSENCODE(chreq.Owner.Name)} </td>
                                                                    <td>  {!JSENCODE(TEXT(chreq.CreatedDate))}</td>
                                                                    <td> {!JSENCODE(chreq.Status__c)} </td>
                                                                    
                                                                </tr>   
                                                            </apex:repeat>
                                                            
                                                            
                                                            
                                                        </tbody>
                                                    </table>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!------------------------------------------------------>
                    
                    <!------------------------------------------------------>
                    <apex:outputPanel rendered="{!documentProfile.Approval_Required__c==true}">
                        <h2>Approvers</h2>
                        <table class="table table-responsive table-bordered">
                            <tbody>
                                <tr>
                                    <th>Approver</th>
                                    <th>Sequence</th>
                                    <th>Allowed Days</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Approved Date</th>
                                </tr>
                                <apex:repeat value="{!documentProfileApprovers}" var="Ap">
                                    <tr>
                                        <td>{!Ap.User__r.Name}</td>
                                        <td>{!Ap.Sequence_Position__c}</td>
                                        <td>{!Ap.Allowed_Days__c}</td>
                                        <td>
                                            <apex:outputText value="{0,date,dd MMM yyyy}">
                                                <apex:param value="{!Ap.Due_Date__c}" /> 
                                            </apex:outputText>                                  
                                        </td>
                                        <td><apex:outputText value="{!Ap.Status__c}" rendered="{!documentProfile.Status__c!='Open'}"></apex:outputText> </td>
                                        <td>
                                            <apex:outputText rendered="{!documentProfile.Status__c!='Open'}" value="{0,date,dd MMM yyyy}">
                                                <apex:param value="{!Ap.Status_Updated__c}" /> 
                                            </apex:outputText>                                      
                                        </td>
                                    </tr>                                
                                </apex:repeat>
                                
                            </tbody>
                        </table>
                    </apex:outputPanel>
                    <!-------------------------------------------------------->
                    <div class="panel-group screen-only" id="accordion" role="tablist" aria-multiselectable="true">
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="headingDPReference">
                                <h4 class="panel-title">
                                    <a class="btn btn-link btn-xs pull-right" data-toggle="collapse" data-parent="#accordion" href="#collapseDPReference" aria-expanded="true" aria-controls="collapseDPResolutionCode">
                                        <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>
                                    </a>                            
                                    
                                    
                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseDPReference" aria-expanded="true" aria-controls="collapseDPReference">
                                        Reference
                                    </a>
                                </h4> 
                            </div>            
                            
                            <div id="collapseDPReference" class="panel-collapse collapse out" role="tabpanel" aria-labelledby="headingDPReference">
                                <div class="panel-body">                        
                                    <div class="add-XReference-wrapper screen-only">
                                        <div class="add-XReference">                    
                                            <div class="panel-body">
                                                <h2>NC</h2>
                                                                                <table class="table table-hover table-condensed">
                                                                                    <tbody>
                                                                                        <tr>
                                                                                            <th>{!$ObjectType.Non_Conformance__c.Fields.Name.Label}</th>
                                                                                            <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Type__c.Label}</th>
                                                                                            <th>{!SUBSTITUTE($ObjectType.Non_Conformance__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                                                            <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Source__c.Label}</th>
                                                                                            <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Status__c.Label}</th>
                                                                                            <th></th>
                                                                                        </tr>
                                                                                        <apex:repeat value="{!nonConf}" var="ncon">
                                                                                        <tr id="{!JSENCODE(ncon.id)}">
                                                                                            <td><a href='/{!JSENCODE(ncon.Non_Conformance__c)}'><apex:outputtext value="{!ncon.Non_Conformance__r.Name}"/></a></td>
                                                                                            <td><apex:outputtext value="{!ncon.NC_Type__c}"/></td>
                                                                                            <td><apex:outputtext value="{!ncon.Owner__c}"/></td>
                                                                                            <td><apex:outputtext value="{!ncon.Source__c}"/></td>
                                                                                            <td><apex:outputtext value="{!ncon.Status__c}"/></td>
                                                                                            <td><i class="fa fa-remove" onclick="removeRow('{!JSENCODE(ncon.id)}');"></i></td>
                                                                                        </tr>
                                                                                    
                                                                                    </apex:repeat>

                                                                                    </tbody>
                                                                                </table>
                                                                                
                                                                                <h2>CAPA</h2>
                                                                                <table class="table table-hover table-condensed">
                                                                                    <tbody>
                                                                                        <tr>
                                                                                            <th>{!$ObjectType.CAPA__c.Fields.Name.Label}</th>
                                                                                            <th>{!$ObjectType.CAPA__c.Fields.Title__c.Label}</th>
                                                                                            <th>{!SUBSTITUTE($ObjectType.CAPA__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                                                            <th>{!$ObjectType.CAPA__c.Fields.CAPA_Source__c.Label}</th>
                                                                                            <th>{!$ObjectType.CAPA__c.Fields.CAPA_Status__c.Label}</th>
                                                                                            <th></th>
                                                                                        </tr>
                                                                                        <apex:repeat value="{!capaList}" var="capa">
                                                                                        <tr id="{!JSENCODE(capa.id)}">
                                                                                            <td><a href='/{!JSENCODE(capa.CAPA__c)}'><apex:outputtext value="{!capa.CAPA__r.Name}"/></a></td>
                                                                                            <td><apex:outputtext value="{!capa.Title__c}"/></td>
                                                                                            <td><apex:outputtext value="{!capa.Owner__c}"/></td>
                                                                                            <td><apex:outputtext value="{!capa.Source__c}"/></td>
                                                                                            <td><apex:outputtext value="{!capa.Status__c}"/></td>
                                                                                            <td><i class="fa fa-remove" onclick="removeRow('{!JSENCODE(capa.id)}');"></i></td>
                                                                                        </tr>
                                                                                    
                                                                                   </apex:repeat> 
                                                                                        
                                                                                    </tbody>
                                                                                </table>
                                                                                
                                                                                <h2>Documents</h2>
                                                                                <table class="table table-hover table-condensed">
                                                                                    <tbody>
                                                                                        <tr>
                                                                                            <th>{!$ObjectType.Document_Profile__c.Fields.Name.Label}</th>
                                                                                            <th>{!$ObjectType.Document_Profile__c.Fields.Current_Rev__c.Label}</th>
                                                                                            <th>{!$ObjectType.Document_Profile__c.Fields.Relation__c.Label}</th>
                                                                                            <th>{!SUBSTITUTE($ObjectType.Document_Profile__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                                                            <th>{!$ObjectType.Document_Profile__c.Fields.Status__c.Label}</th>
                                                                                            <th></th>
                                                                                        </tr>
                                                                                        <apex:repeat value="{!docList}" var="doc">
                                                                                        <tr id="{!JSENCODE(doc.id)}">
                                                                                            <td><a href='/{!JSENCODE(if(doc.DocumentChild__c!=dmid,doc.DocumentChild__c,doc.DocumentParent__c))}'><apex:outputtext value="{!if(doc.DocumentChild__c!=dmid,doc.DocumentChild__r.Name,doc.DocumentParent__r.Name)}"/></a></td>
                                                                                            <td><apex:outputtext value="{!doc.Current_Rev__c}"/></td>
                                                                                            <td><apex:outputtext value="{!if(doc.DocumentChild__c!=dmid,doc.RelationWithParent__c,doc.RelationWithChild__c)}"/></td>
                                                                                            <td><apex:outputtext value="{!doc.Owner__c}"/></td>
                                                                                            <td><apex:outputtext value="{!doc.Status__c}"/></td>
                                                                                            <td><i class="fa fa-remove" onclick="removeRow('{!JSENCODE(doc.id)}');"></i></td>
                                                                                        </tr>
                                                                                   </apex:repeat>
                                                                                        
                                                                                    </tbody>
                                                                                </table>
                                                
                                                
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                     <!--v1.1 start-->   
                    <apex:outputPanel >
                        
                        <!----------------------------------------------------------------------------->
                        <apex:outputPanel rendered="true">
                            <div class="panel panel-default screen-only">
                                <div class="panel-heading" role="tab" id="headingOne">
                                    <h4 class="panel-title">
                                        <a class="btn btn-link btn-xs pull-right" data-toggle="collapse" data-parent="#accordionCR" href="#crDetails" aria-expanded="true" aria-controls="crDetails"><span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>
                                            
                                        </a><a class="" data-toggle="collapse" data-parent="#accordionCR" href="#crDetails" aria-expanded="true" aria-controls="crDetails">
                                        Collaboration Review 
                                        
                                        </a>
                                    </h4>
                                </div>
                                <div aria-expanded="true" style="" id="crDetails" class="panel-collapse out collapse out" role="tabpanel" aria-labelledby="headingOne">
                                    <div class="panel-body">
                                        <apex:repeat value="{!collRevHistory}" var="col">
                                                
                                                <!-- multi panel starts -->
                                                
                                                
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">Review&nbsp;&nbsp; <apex:outputText value="{0,date,dd MMM yyyy}">
                                                        <apex:param value="{!rev1.review}" /> 
                                                        </apex:outputText> | Expire &nbsp;&nbsp;<apex:outputText value="{0,date,dd MMM yyyy}">
                                                        <apex:param value="{!rev1.dueDate}" /> 
                                                        </apex:outputText></div>
                                                    <div class="panel-body">                              
                                                        
                                                        <table class="table table-responsive table-bordered">                                      
                                                            <tbody>
                                                                <tr>
                                                                    <td colspan="3">
                                                                        <h4>{!$ObjectType.General_Task__c.Fields.Collaboration_Title__c.Label}</h4>
                                                                    </td>
                                                                    <td>{!collRevHistory[col].title}</td>
                                                                </tr>
                                                                
                                                                <tr>
                                                                    <td colspan="3">
                                                                        <h4> Primary File Location </h4>
                                                                    </td>
                                                                    <td>{!collRevHistory[col].primaryfilepath}</td>
                                                                </tr>
                                                                
                                                                <tr>
                                                                    <td colspan="3">
                                                                        <h4> {!$ObjectType.General_Task__c.Fields.Review_Description__c.label} </h4>
                                                                    </td>
                                                                    <td>{!collRevHistory[col].revDescription}</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        
                                                        <!--<apex:outputpanel rendered="{!collRevHistory[col].show}">-->
                                                        <div class="add-approver-row" id="Review1_div">
                                                            <table class="table table-bordered" id="Review_table_{!collRevHistory[col].incrementer}">
                                                                <thead>
                                                                    <tr>
                                                                        <td><span class="mandatory"><apex:outputtext value=""/></span>Reviewer Name</td>
                                                                        <td width="40%"><span class="mandatory"><apex:outputtext value=""/></span>Approval Date</td>
                                                                        <td width="20%"><span class="mandatory"><apex:outputtext value=""/></span>Status</td>
                                                                        
                                                                    </tr>
                                                                    <tr>
                                                                        <td>{!collRevHistory[col].Reviewer_Name}
                                                                        </td>
                                                                        <td>
                                                                            <apex:outputText value="{0,date,dd MMM yyyy}">
                                                                                <apex:param value="{!collRevHistory[col].Approval_Date}" /> 
                                                                            </apex:outputText>
                                                                        </td>
                                                                        <td>{!collRevHistory[col].status}
                                                                            
                                                                            
                                                                            
                                                                            
                                                                        </td>
                                                                    </tr>
                                                                </thead>
                                                                
                                                                <tbody>
                                                                    <tr class="" id="row_1">
                                                                        
                                                                        
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            
                                                        </div>
                                                       <!-- </apex:outputpanel>-->
                                                    </div>
                                                    
                                                    
                                                    
                                                </div>   
                                            </apex:repeat>   
                                        </div>
                                    </div>
                                </div>
                           
                        </apex:outputPanel>
                        <div class="clearfix"></div>
                        <!--<c:wiz_task_details module="Document" effectivenessReview="{!elist}"></c:wiz_task_details>-->
                        <div class="panel panel-default screen-only">
                        <div class="panel-heading" role="tab" id="headingOne">
                          <h4 class="panel-title">
                            <a class="btn btn-link btn-xs pull-right" data-toggle="collapse" data-parent="#accordionER" href="#erDetails" aria-expanded="true" aria-controls="erDetails"><span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>
                            
                            </a><a class="" data-toggle="collapse" data-parent="#accordionER" href="#erDetails" aria-expanded="true" aria-controls="erDetails">
                              Effetiveness Review 
                              
                            </a>
                          </h4>
                        </div>
                        <div aria-expanded="true" style="" id="erDetails" class="panel-collapse out collapse out" role="tabpanel" aria-labelledby="headingOne">
                          <div class="panel-body">
                                <apex:repeat value="{!effRevHistory}" var="actionPlan">
                                    
                                    <!-- multi panel starts -->
                                    <div class="panel panel-default">
                                        <div class="panel-heading">Review&nbsp;&nbsp; <apex:outputText value="{0,date,dd MMM yyyy}">
                                            <apex:param value="{!rev1.review}" /> 
                                            </apex:outputText> | Expire &nbsp;&nbsp;<apex:outputText value="{0,date,dd MMM yyyy}">
                                            <apex:param value="{!rev1.dueDate}" /> 
                                            </apex:outputText></div>
                                        <div class="panel-body">                              
                                            <table class="table table-responsive table-bordered">                                      
                                                <tbody>
                                                    <tr>
                                                        <td colspan="3">
                                                            <h4>{!$ObjectType.General_Task__c.Fields.Owner__c.Label}</h4>{!effRevHistory[actionPlan].ownerName} 
                                                        </td>
                                                        <td colspan="3">
                                                            <h4>{!$ObjectType.General_Task__c.Fields.Due_Date__c.Label}</h4>
                                                            <apex:outputText value="{0,date,dd MMM yyyy}">
                                                                <apex:param value="{!effRevHistory[actionPlan].dueDate}" /> 
                                                            </apex:outputText>
                                                        </td>
                                                        
                                                    </tr>
                                                    
                                                     <tr>
                                                        <td colspan="3">
                                                            <h4>{!$ObjectType.General_Task__c.Fields.Document_Status__c.Label}</h4>{!effRevHistory[actionPlan].documentStatus}
                                                        </td>
                                                         
                                                         <td colspan="3"> 
                                                            <h4>{!$ObjectType.Document_Profile__c.Fields.New_Expiration_Date__c.label}</h4> 
                                                            <apex:outputText value="{0,date,dd MMM yyyy}">
                                                                <apex:param value="{!effRevHistory[actionPlan].newExpirationDate}" /> 
                                                            </apex:outputText>
                                                        </td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td colspan="10">
                                                            <h4>{!$ObjectType.General_Task__c.Fields.Review_Description__c.Label}</h4> 
                                                            <p>
                                                                {!effRevHistory[actionPlan].revDescription}
                                                            </p>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <apex:outputpanel rendered="{!effRevHistory[actionPlan].show}">
                                                <div class="add-approver-row " id="Review1_div">
                                                    <table class="table table-bordered " id="Review_table_{!effRevHistory[actionPlan].incrementer}">
                                                        <thead>
                                                            <tr>
                                                                <td><span class="mandatory"><apex:outputtext value=""/></span>Reviewer Name</td>
                                                                <td width="40%"><span class="mandatory"><apex:outputtext value=""/></span>Approval Date</td>
                                                                <td width="20%"><span class="mandatory"><apex:outputtext value=""/></span>Status</td>
                                                                
                                                            </tr>
                                                            <tr>
                                                                <td>{!effRevHistory[actionPlan].Reviewer_Name}
                                                                </td>
                                                                <td>
                                                                    <apex:outputText value="{0,date,dd MMM yyyy}">
                                                                        <apex:param value="{!effRevHistory[actionPlan].Approval_Date}" /> 
                                                                    </apex:outputText>
                                                                </td>
                                                                <td>{!effRevHistory[actionPlan].status}
                                                                </td>
                                                            </tr>
                                                        </thead>
                                                        
                                                        <tbody>
                                                            <tr class="" id="row_1">
                                                                
                                                                
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </apex:outputpanel>               
                                            
                                        </div>
                                        
                                        
                                        
                                    </div>   
                                </apex:repeat>   
                            </div>
                            
                            
                        </div>
                        </div>
                        
                    </apex:outputPanel>
                    <!-- v1.1 end -->  
                </apex:outputPanel>
                <!--Details--->
                
            </apex:define>
             <apex:define name="approvalHistory">
                   <c:wiz_approvalHistory rendered="{!OR($CurrentPage.parameters.pg=='doc_Approval')}" Parent="Change Management" TargetobjectId="{!$CurrentPage.parameters.id}"></c:wiz_approvalHistory>  
             </apex:define>
            <apex:define name="buttonbar">
                
                <div
                     class="fix-footer navbar-fixed-bottom navbar-inverse wiz-button-bar"
                     style="position: fixed">
                    <div class="col-sm-12 text-right">
                        
                         <apex:outputPanel rendered="{!OR(ISBLANK($CurrentPage.parameters.id))}">
                            <apex:outputpanel layout="none"
                                              rendered="{!AND(OR($ObjectType.Document_Profile__c.Updateable, AND(ISBLANK(Document_Profile__c.Id), $ObjectType.Document_Profile__c.Createable)))}">
                                <apex:outputPanel rendered="{!documentProfile.Status__c!='Void'}">
                                    <button type="button" class="btn btn-default"
                                            onclick="cancelPopup();">
                                        <span class="fa fa-close"></span> Cancel
                                    </button>
                                    
                                    <button type="submit"
                                            onclick="$(this).addClass('most-recent-click');$('#nextBtn').removeClass('most-recent-click');validate(null,undefined,'docForm');"
                                            id="submitBtn"
                                            class="btn {!IF(NOT(ISBLANK(documentProfile.Id)),'btn-primary','btn-success')} dont-allow-multiple-clicks">
                                        <span
                                              class="fa {!IF(NOT(ISBLANK(documentProfile.Id)),'fa fa-floppy-o','fa fa-send')}"></span>
                                        {!IF(NOT(ISBLANK(documentProfile.Id)),'Save','Submit')}
                                    </button>
                                </apex:outputPanel>
                                <apex:outputpanel layout="none"
                                                  rendered="{!NOT(ISBLANK(Document_Profile__c.Id))}">
                                    
                                    <button type="submit" id="nextBtn"
                                            onclick="$(this).addClass('most-recent-click'); $('#submitBtn').removeClass('most-recent-click');
                                                     window.location.href = '/apex/DocumentProfile?id={!JSENCODE($Currentpage.parameters.Id)}&pg=doc_prof'"
                                            class="btn btn-primary dont-allow-multiple-clicks">
                                        <span class="fa fa-step-forward"></span> Next
                                    </button>
                                    
                                    
                                </apex:outputpanel>
                                
                                
                            </apex:outputpanel>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!AND(OR($CurrentPage.parameters.pg=='doc_prof',ISBLANK($CurrentPage.parameters.pg)),NOT(ISBLANK($CurrentPage.parameters.id)))}">
                            <!--
<button type="button" id="cancel"
class="btn btn-default dont-allow-multiple-clicks"
data-toggle="modal" onclick="cancelPopup();">
<span class="fa fa-close"></span> Cancel
</button>
<button type="button" id="save"
class="btn btn-primary dont-allow-multiple-clicks"
onclick="saveDocumentProfile();">
<span class="fa fa-floppy-o"></span> Save
</button>-->
                            <!--  v1.2    start-->
                            <apex:outputPanel rendered="{!OR(NOT(OR(documentProfile.Status__c!='Draft',documentProfile.Approval_Status__c=='Pending Approval')),NOT(ISBLANK($CurrentPage.parameters.isedit)))}">
                                <button type="button" id="cancel"
                                        class="btn btn-default dont-allow-multiple-clicks"
                                        data-toggle="modal" onclick="cancelPopup();">
                                    <span class="fa fa-close"></span> Cancel
                                </button>
                                <button type="button" id="save"
                                        class="btn btn-primary dont-allow-multiple-clicks"
                                        onclick="DocumentDetailsSubmitvar=false;saveDocumentProfile();">
                                    <span class="fa fa-floppy-o"></span> Save
                                </button>
                                <button type="button" id="DocumentDetailsSubmit"
                                        class="btn btn-success dont-allow-multiple-clicks {!if(documentProfile.Collaboration_Review__c,'hidden','')}"
                                        onclick="DocumentDetailsSubmitvar=true;saveDocumentProfile();">
                                    <span class="fa fa-floppy-o"></span> Submit
                                </button>
                                <!--<button type="submit" id="nextBtn"
                                        onclick="$(this).addClass('most-recent-click'); $('#submitBtn').removeClass('most-recent-click');
                                                 window.location.href = '/apex/DocumentProfile?id={!JSENCODE($Currentpage.parameters.Id)}&pg=doc_prof'"
                                        class="btn btn-primary dont-allow-multiple-clicks {!if(documentProfile.createddate==documentProfile.lastmodifieddate,'hidden','')}">
                                    <span class="fa fa-step-forward"></span> Next
                                </button>-->
                                
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!documentProfile.Collaboration_Review__c}">
                                <button type="submit" id="nextBtn"
                                        onclick="$(this).addClass('most-recent-click'); $('#submitBtn').removeClass('most-recent-click');
                                                 window.location.href = '/apex/documentProfiletask?id={!JSENCODE($Currentpage.parameters.Id)}&gtid_cr={!if(collgenTaskId.SIZE>0,collgenTaskId[0],'gt_init_cr')}&type=CollaborationReview'"
                                        class="btn btn-primary dont-allow-multiple-clicks {!if(documentProfile.createddate==documentProfile.lastmodifieddate,'hidden','')}">
                                    <span class="fa fa-step-forward"></span> Next
                                    
                                </button>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!NOT(documentProfile.Collaboration_Review__c)}">
                                <button type="submit" id="nextBtn"
                                        onclick="$(this).addClass('most-recent-click'); $('#submitBtn').removeClass('most-recent-click');
                                                 window.location.href = '/apex/documentProfile?id={!JSENCODE($Currentpage.parameters.Id)}&pg=doc_Approval'"
                                        class="btn btn-primary dont-allow-multiple-clicks {!if(documentProfile.createddate==documentProfile.lastmodifieddate,'hidden','')}">
                                    <span class="fa fa-step-forward"></span> Next
                                    
                                </button>
                                </apex:outputPanel>
                            <!--  v1.2    End-->
                        </apex:outputPanel>
                        <!--v1.3--document approval start --->
                        <apex:outputPanel rendered="{!(JSENCODE($CurrentPage.parameters.pg)=='doc_Approval')}">
                            <script>
                            var isSubmit=false;
                            function saveDocumentProfileApproval(){
                                if('{!$ObjectType.Document_Profile__c.FieldSets.Document_Approval.size}'!='0'){
                                    validate(null,digitalSig,'DocumentProfileapproval@DocProfile');
                                }
                                else{
                                    validate(null,digitalSig,'DocumentProfileapproval');
                                }
                            }
                            function digitalSig(){
                                
                                var isDigSigNd='<apex:outputtext value="{!$Setup.QC_settings__c.Is_Digital_Signature_Needed__c}" />';
                                if(isDigSigNd=='true'){
                                    $('#uname').val('');$('#pw').val('');$('#signature').modal('show');
                                }
                                else{
                                
                                    if(!$('.dont-allow-multiple-clicks').attr('disabled')){
                                         $('.dont-allow-multiple-clicks').attr('disabled', true);
                                    }
                                    if(!isSubmit){
                                        if('{!$ObjectType.Document_Profile__c.FieldSets.Document_Approval.size}'=='0'){
                                            SubmitDocApprovalProcess();
                                        }else{
                                            $('#DocProfile').submit();
                                        }
                                    }else{
                                        //submit on
                                        if(!document.getElementById("tableId_chk").checked){                                        
                                            $('#DocDetailsSubmit').val('Submit');
                                        }
                                        //
                                        if('{!$ObjectType.Document_Profile__c.FieldSets.Document_Approval.size}'!='0'){
                                            $('#DocProfile').submit();
                                        }else{                                            
                                            $('#DocProfile').submit();
                                            //SubmitDocApprovalProcess();
                                        }
                                    }
                                }
                            }
                            function SubmitDocApprovalProcess(){
                                if(document.getElementById("tableId_chk").checked)
                                {
                                    if(isSubmit){
                                        DocsaveApprovalData('{!documentProfile.id}',true);
                                    }else{
                                        DocsaveApprovalData('{!documentProfile.id}',false);
                                    }
                                }else{
                                    DocdelApprovers();
                                }
                            }
                            function navigatetoApprovalAfterDigitalSignature(){     
                                if(!$('.dont-allow-multiple-clicks').attr('disabled')){
                                         $('.dont-allow-multiple-clicks').attr('disabled', true);
                                    }                           
                                if(!document.getElementById("tableId_chk").checked){
                                    $('#DocDetailsSubmit').val('Submit');
                                }
                                $('#DocProfile').submit();
                            }
                            
                            </script>
                            
                            
                            <apex:outputPanel rendered="{!AND(documentProfile.Status__c=='Draft',documentProfile.Approval_Status__c!='Pending Approval')}">
                                
                                <button type="button" id="cancel"
                                    class="btn btn-default dont-allow-multiple-clicks"
                                    data-toggle="modal" onclick="cancelPopup();">
                                <span class="fa fa-close"></span> Cancel
                                </button>
                                
                                <button type="button" id="save"
                                        class="btn btn-primary dont-allow-multiple-clicks"
                                        onclick="saveDocumentProfileApproval();">
                                    <span class="fa fa-floppy-o"></span> Save
                                </button>       
                                <apex:variable value="{!0}" var="showSubmit"/>
                                <apex:variable value="{!0}" var="collabcount"/>
                                <apex:repeat value="{!Document_Profile__c.General_Tasks__r}"  var="collaborationreview">                  
                                    <apex:variable value="{!collabcount+1}" var="collabcount"/>
                                    <apex:variable rendered="{!collaborationreview.Status__c!='Closed'}" value="{!showSubmit+1}" var="showSubmit"/>
                                </apex:repeat>
                                
                                 <button type="button" id="submit"
                                        class="btn btn-success dont-allow-multiple-clicks {!if(AND(documentProfile.collaboration_review__c,collabcount!=0,showSubmit==0),'','hidden')}"
                                        onclick="isSubmit=true;saveDocumentProfileApproval();">
                                    <span class="fa fa-floppy-o"></span> Submit
                                </button>
                                
                                
                               <!-- <button type="submit" id="nextBtn"
                                        onclick="$(this).addClass('most-recent-click'); $('#submitBtn').removeClass('most-recent-click');
                                                 window.location.href = '/apex/documentProfiletask?id={!JSENCODE($Currentpage.parameters.Id)}&gtid_er={!if(NOT(ISBLANK(efrgenTaskId)),efrgenTaskId,'gt_init_er')}&type=EffectivenessReview'"
                                        class="btn btn-primary dont-allow-multiple-clicks {!if(AND(DocumentProfiles.status__c=='Current',NOT(ISNULL(DocumentProfiles.Effectiveness_Review_Date__c))),'','hidden')}">
                                    <span class="fa fa-step-forward"></span> Nextgtid_er=gt_init
                                </button>-->
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!documentProfile.Approval_Status__c=='Pending Approval'}">     
                                <apex:outputPanel rendered="{!OR($User.Id==documentProfile.Approver__c,$User.Id==documentProfile.Approver_1__c,$User.Id==documentProfile.Approver_2__c,$User.Id==documentProfile.Approver_3__c,$User.Id==documentProfile.Approver_4__c,$User.Id==documentProfile.Approver_5__c,$User.Id==documentProfile.Approver_6__c,$User.Id==documentProfile.Approver_7__c,$User.Id==documentProfile.Approver_8__c,$User.Id==documentProfile.Approver_9__c)}">
                                    <button type="submit" id="ApprovaButtonIdNcContainment"  onclick="ApprovePopupModal();" class="btn btn-success  dont-allow-multiple-clicks"><span class='fa fa-thumbs-o-up'></span> Decision</button>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!(documentProfile.Initial_Submitter__c==$User.Id)}">
                                    <button type="submit" id="RecallButtonIdNcContainment"  onclick="RecallPopupModal();" class="btn btn-primary  dont-allow-multiple-clicks "><span class="fa fa-mail-reply-all"></span> Recall</button>     
                                </apex:outputPanel> 
                            </apex:outputPanel>     
                            
                            <apex:outputPanel rendered="{!AND(DocumentProfiles.Status__c=='Current',NOT(ISNULL(DocumentProfiles.Effectiveness_Review_Date__c)))}">
                                <button type="submit" id="nextBtn"
                                        onclick="$(this).addClass('most-recent-click'); $('#submitBtn').removeClass('most-recent-click');
                                                 window.location.href = '/apex/documentProfiletask?id={!JSENCODE($Currentpage.parameters.Id)}&gtid_er={!if(efrgenTaskId.SIZE>0,efrgenTaskId[0],'gt_init')}&type=EffectivenessReview'"
                                        class="btn btn-primary dont-allow-multiple-clicks {!if(AND(DocumentProfiles.status__c=='Current',NOT(ISNULL(DocumentProfiles.Effectiveness_Review_Date__c))),'','hidden')}">
                                    <span class="fa fa-step-forward"></span> Next
                                    
                                </button>
                                </apex:outputPanel>
                        </apex:outputPanel>
                        <!--v1.3---document approval End--->
                    </div>
                </div> 
            </apex:define>
            
  <!-- v1.1 start -->
            <!---contextual Help in progess starts-->
            <apex:define name="rightpane">
                <div id="rightContainer" class="tab-content">
                     <!-- Help Pane -->
                    <div class="tab-pane active help" id="help">
                     <apex:outputPanel >
         <div>
              <h2  class="section-title"  >Document  Management</h2><br/>
         Document  Management is the first step in the Document management process. All the fields in this section is a required field. <br/>
            <h4> 1. Document Type </h4>
            Select either Product or Process to categorize the event. Based on this field, either 'Select Product' or 'Select Process' field is displayed.
            <br/>
            <h4>2. Document Owner </h4>
            This field is used to identify the person who is responsible for completing the DOC. Defaults to logged on user initiating the DOC, however, the user has an option to change the value.<br/>
            <h4>3. Product</h4> 
            - Visible only if Document Type is 'Product'<br/>
            In this field a user can select either the product or part or component value from a  predefined list specified in the Product/Part/Component table. The product identified  in this step is considered to be the primary. Additional product, Lot/Batch can be added once the DOC record is created.<br/>
            <h4>4. Process</h4> 
            - Visible only if DOC Type is 'Process'<br/>
            In this field a user can select either an operation or standard operation from a predefined list specified in the Standard Operational Process/Operational Process table.<br/>
                 </div>
        
        </apex:outputPanel>
                    
             <!--   <c:Contextual_Help currentpage1="{!IF(ISBLANK($CurrentPage.parameters.pg),'capa_init',$CurrentPage.parameters.pg)}" /> -->
            </div>
           
                    <div Class="tab-content">
                        <c:wiz_attachments record_id="{!documentProfile.Id}" showAddButtonLink="{!AND(NOT(ISBLANK(documentProfile.Id)),NOT(documentProfile.Status__c=='Closed'))}"></c:wiz_attachments>
                    </div>
                    
                    <!-- chronology-->
                    <div class="tab-pane  chronology" id="chronology">
                        <c:documentprofile_chronology rendered="{!$CurrentPage.parameters.pg=='doc_Details'}" DPID="{!JSENCODE(documentProfile.Id)}"/>                     
                    </div> 
                    <!--chronology -->
                </div>
            </apex:define>
             <!--contextual help in progress ends--> 
            <!-- v1.1 end -->
        </apex:composition>
    </div>
    
    <apex:outputPanel rendered="{!OR($CurrentPage.parameters.pg=='doc_init',ISBLANK($CurrentPage.parameters.pg))}">
        <c:digital_signature onSuccess="navigateAfterDigitalSignature()" />
        <c:wiz_validator onValid="if({!OR($CurrentPage.parameters.pg=='doc_init',ISBLANK($CurrentPage.parameters.pg))})onValidInit();"
                         ignorehidden="" />
    </apex:outputPanel>
    <apex:outputPanel rendered="{!OR($CurrentPage.parameters.pg=='doc_Approval')}">
        <c:digital_signature onSuccess="navigatetoApprovalAfterDigitalSignature()" />
        <c:wiz_validator onValid=""
                         ignorehidden="" />
    </apex:outputPanel>
    <c:wiz_alert alertId="WizAlert"/>
    
    <!----------------------------v1.5 start----------------------------------------------->
    <apex:outputPanel rendered="{!$CurrentPage.parameters.pg=='doc_Details_Print'}">
            <html>
        <head>
            <meta charset="utf-8" />
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
            <meta name="description" content="" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <apex:stylesheet value="{!URLFOR($Resource.bt_static,  '/static/stylesheets/app.css')}" />
            <apex:stylesheet value="{!URLFOR($Resource.bt_static,  '/static/stylesheets/bootstrap-datepicker.min.css')}" />
            <title>Document Report</title>
            
        </head>
        <body style="background-color: #FFF;">
            <apex:stylesheet value="{!URLFOR($Resource.bt_static,  '/static/stylesheets/app.css')}" />
            <script>
            window.onload =function() { window.print(); };
            </script>
            <div class="" id="app_warpper">
                <div class="report-holder">
                    <div class="wiz-form-holder" style="padding: 20px;">
                        <div class="row">
                            <div class="col-md-12">
                                <img src ="{! URLFOR($Resource.bt_static,'/static/images/report-logo.png') }" class="report-logo"/>
                            </div>
                            
                            
                            
                            <div class="col-md-12">
                                <h1>Document Header</h1>
                                <table class="table table-responsive table-bordered">
                                    <tbody>
                                        <tr>
                                            <th>{!JSENCODE($ObjectType.Document_Profile__c.Fields.Name.Label)}</th>
                                            <th>{!$Label.Revision}:</th>
                                            <th> Owner:</th>
                                            <th>{!JSENCODE($ObjectType.Document_Profile__c.Fields.Effective_Date__c.Label)}</th>
                                            <th>{!$ObjectType.Document_Profile__c.Fields.Expiration_Date__c.Label}</th>
                                            <th>{!$ObjectType.Document_Profile__c.Fields.Document_Type__c.Label}</th>
                                            <th>{!$ObjectType.Document_Profile__c.Fields.Status__c.Label}</th>
                                        </tr>
                                        
                                        <tr>
                                            <td>{!JSENCODE(documentProfile.Name)}</td>
                                            <td>{!documentProfile.Current_Rev__c}</td>
                                            <td>{!JSENCODE(documentProfile.Owner.Name)}</td>
                                            <td><apex:outputText value="{0,date, dd MMM yyyy}"> 
                                                <apex:param value="{!documentProfile.Effective_Date__c}"/>
                                                </apex:outputText></td>
                                            <td> <apex:outputText value="{0,date, dd MMM yyyy}"> 
                                                <apex:param value="{!documentProfile.Expiration_Date__c}"/>
                                                </apex:outputText> </td>
                                            <td>
                                                {!documentProfile.Document_Type__r.Name}
                                            </td>
                                            <td>{!documentProfile.Status__c}</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <h1><apex:outputText value="{!$Label.Document_Initiation}"/></h1>  <!-- make value dynamic here -->
                                
                                <table class="table table-responsive table-bordered">
                                    <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Initiation_Fields}"
                                                 var="f">
                                        <tr>
                                            <td class="title-col">
                                                {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                            </td>
                                            <td>
                                                <apex:outputPanel rendered="{!f!='Document_Type__c'}">
                                                    <apex:outputField rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type!='reference',$ObjectType.Document_Profile__c.Fields[f].type!='textarea')}" value="{!documentProfile[f]}"/>
                                                    <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}">
                                                        {!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='textarea'}">
                                                        <div class="alert alert-info">
                                                            <apex:outputField value="{!documentProfile[f]}"></apex:outputField>
                                                        </div>
                                                    </apex:outputPanel>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!f=='Document_Type__c'}">
                                                    
                                                    <apex:outputField value="{!documentProfile.Document_Type__r.Title__c}"/>
                                                    (<apex:outputText value="{!documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name}"/> )
                                                </apex:outputPanel>
                                            </td>
                                        </tr>
                                    </apex:repeat>                    
                                </table>
                                
                                <!-----------------custom fileds---------------------------------->
                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.FieldSets.Document_Profile_Custom_Fields.size!=0}">
                                    <h1><apex:outputText value="Custom Fields" /></h1>
                                    <table class="table table-responsive table-bordered">
                                        <tbody>
                                            <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Document_Profile_Custom_Fields}" var="f">
                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].Accessible}">
                                                    <tr>
                                                        <td class="title-col">
                                                            {!$ObjectType.Document_Profile__c.Fields[f].label}
                                                        </td>
                                                        <td>
                                                            <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='textarea'}">
                                                                <div class="alert alert-info"> <apex:outputField value="{!documentProfile[f]}" /> </div>
                                                            </apex:outputPanel>
                                                            <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='date'}">
                                                                <apex:outputText value="{0,date, dd MMMM yyyy}"> 
                                                                    <apex:param value="{!documentProfile[f]}"/>
                                                                </apex:outputText>
                                                            </apex:outputPanel>
                                                            <apex:outputPanel rendered="{!NOT(OR($ObjectType.Document_Profile__c.Fields[f].type=='date',$ObjectType.Document_Profile__c.Fields[f].type=='reference',$ObjectType.Document_Profile__c.Fields[f].type=='textarea'))}">
                                                                {!JSENCODE(documentProfile[f])}
                                                            </apex:outputPanel>
                                                            <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}">
                                                                {!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}
                                                            </apex:outputPanel>
                                                        </td>
                                                    </tr>                                
                                                </apex:outputPanel>  
                                            </apex:repeat>
                                        </tbody>
                                    </table>
                                </apex:outputPanel> 
                                
                                 <table class="table table-responsive table-bordered">
                                                <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.DocumentEditLayout}"
                                                             var="f">
                                                    <tr>
                                                        <td class="title-col">
                                                            {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                                        </td>
                                                        <td>
                                                            <apex:outputPanel rendered="{!f!=IF(NOT(ISBLANK(Prefix)),Prefix+'__Impacted_Sites__c','Impacted_Sites__c')}">
                                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='textarea'}">
                                                                <div class="alert alert-info"> <apex:outputField value="{!documentProfile[f]}" /> </div>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='date'}">
                                                                    <apex:outputText value="{0,date, dd MMMM yyyy}"> 
                                                                        <apex:param value="{!documentProfile[f]}"/>
                                                                    </apex:outputText>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!NOT(OR($ObjectType.Document_Profile__c.Fields[f].type=='date',$ObjectType.Document_Profile__c.Fields[f].type=='reference',$ObjectType.Document_Profile__c.Fields[f].type=='textarea'))}">
                                                                    {!JSENCODE(documentProfile[f])}
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}">
                                                                    {!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}
                                                                </apex:outputPanel>
                                                            </apex:outputPanel>
                                                            <apex:outputPanel rendered="{!f==IF(NOT(ISBLANK(Prefix)),Prefix+'__Impacted_Sites__c','Impacted_Sites__c')}">
                                                                <div class="col-md-12">
                                                                    <c:wiz_multi width="100%"
                                                                                 required="{!f.required}"
                                                                                 FieldId="{!f}"
                                                                                 multiple="true"
                                                                                 FieldName="{!f}"
                                                                                 queryFields="Name"
                                                                                 querytable="{!IF(NOT(ISBLANK(Prefix)),Prefix+'__','')}Manufacturing_Site__c"
                                                                                 dataid=""                                      
                                                                                 disabled="true">
                                                                        <apex:repeat value="{!ImpactedSites}" var="impatedsite">
                                                                            <option selected="selected" value="{!JSENCODE(impatedsite.id)}">{!JSENCODE(impatedsite.Name)}</option>
                                                                        </apex:repeat>
                                                                    </c:wiz_multi>                             
                                                                </div>
                                                                
                                                                <!-- initvalues="{value: '{!JSENCODE(documentProfile[f])}', label:'{!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}'}"-->                       
                                                            </apex:outputPanel>
                                                        </td>
                                                    </tr>
                                                </apex:repeat>                  
                                            </table>
                                <h1><apex:outputText value="Document Setup" /></h1> 
                                
                                <table class="table table-responsive table-bordered">
                                    <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Document_Setup}"
                                                 var="f">
                                        <tr>
                                            <td class="title-col">
                                                {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                            </td>
                                            <td>
                                                <apex:outputField rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type!='reference',$ObjectType.Document_Profile__c.Fields[f].type!='textarea')}" value="{!documentProfile[f]}"/>
                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}">
                                                    {!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='textarea'}">
                                                    <div class="alert alert-info">
                                                        <apex:outputField value="{!documentProfile[f]}"></apex:outputField>
                                                    </div>
                                                </apex:outputPanel>
                                            </td>
                                        </tr>
                                    </apex:repeat>                    
                                </table>
                                
                                <!-- <h1><apex:outputText value="Watermark Section" /></h1> 

<table class="table table-responsive table-bordered">
<apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Watermark_Section}"
var="f">
<tr>
<td class="title-col">
{!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
</td>
<td>
<apex:outputField value="{!documentProfile[f]}"/> 
</td>
</tr>
</apex:repeat>                    
</table>-->
                                
                                <h1><apex:outputText value="Document Content" /></h1> 
                                
                                <table class="table table-responsive table-bordered">
                                    <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Document_Content}"
                                                 var="f">
                                        <tr>
                                            <td class="title-col">
                                                {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                            </td>
                                            <td>
                                                <apex:outputField rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type!='reference',$ObjectType.Document_Profile__c.Fields[f].type!='textarea')}" value="{!documentProfile[f]}"/>
                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}">
                                                    {!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='textarea'}">
                                                    <div class="alert alert-info">
                                                        <apex:outputField value="{!documentProfile[f]}"></apex:outputField>
                                                    </div>
                                                </apex:outputPanel> 
                                            </td>
                                        </tr>
                                    </apex:repeat>                    
                                </table>
                                
                                <h1><apex:outputText value="Document Security"/></h1>
                                <table class="table table-responsive table-bordered">
                                    <apex:repeat value="{!$ObjectType.Document_Profile__c.FieldSets.Security_Fields}"
                                                 var="f">
                                        <tr>
                                            <td class="title-col">
                                                {!if($ObjectType.Document_Profile__c.Fields[f].Label=='Owner ID','Owner',$ObjectType.Document_Profile__c.Fields[f].Label)}
                                            </td>
                                            <td>
                                                <apex:outputField rendered="{!AND($ObjectType.Document_Profile__c.Fields[f].type!='reference',$ObjectType.Document_Profile__c.Fields[f].type!='textarea')}" value="{!documentProfile[f]}"/>
                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='reference'}">
                                                    {!JSENCODE(documentProfile[$ObjectType.Document_Profile__c.Fields[f].relationshipName].Name)}
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!$ObjectType.Document_Profile__c.Fields[f].type=='textarea'}">
                                                    <div class="alert alert-info">
                                                        <apex:outputField value="{!documentProfile[f]}"></apex:outputField>
                                                    </div>
                                                </apex:outputPanel>
                                            </td>
                                        </tr>
                                    </apex:repeat>
                                </table>
                                
                                <h1><apex:outputText value="Change Requests"/></h1>
                                <table class="table table-responsive table-bordered">
                                    <table class="table table-hover">
                                                       <tbody>
                                                            <tr>
                                                                <th>{!$ObjectType.Change_Management__c.Fields.Name.Label}</th>
                                                                <th>{!$ObjectType.Change_Management__c.Fields.Title__c.Label}</th>
                                                                <th> Originated from</th>
                                                                <th>Owner</th>
                                                                <th>Created Date</th> 
                                                                <th>{!$ObjectType.Change_Management__c.Fields.Status__c.Label}</th>
                                                            </tr>
                                                            <apex:repeat value="{!CmList}" var="chreq">
                                                                <tr id="{!JSENCODE(chreq.Id)}">
                                                                    <td><a href='/{!JSENCODE(chreq.id)}'> {!JSENCODE(chreq.name)} </a></td>
                                                                    <td> {!JSENCODE(chreq.Title__c)} </td>
                                                                     <td> {!JSENCODE(chreq.Name)}({!JSENCODE(chreq.Current_Revision__c)}) </td>
                                                                    <td> {!JSENCODE(chreq.Owner.Name)} </td>
                                                                    <td>  {!JSENCODE(TEXT(chreq.CreatedDate))}</td>
                                                                    <td> {!JSENCODE(chreq.Status__c)} </td>
                                                                    
                                                                </tr>   
                                                            </apex:repeat>
                                                        </tbody>
                                                    </table>
                                </table>
                                
                                <apex:outputPanel rendered="{!documentProfile.Approval_Required__c==true}">
                                    <h2>Approvers</h2>
                                    <table class="table table-responsive table-bordered">
                                        <tbody>
                                            <tr>
                                                <th>Approver</th>
                                                <th>Sequence</th>
                                                <th>Allowed Days</th>
                                                <th>Due Date</th>
                                                <th>Status</th>
                                                <th>Approved Date</th>
                                            </tr>
                                            <apex:repeat value="{!documentProfileApprovers}" var="Ap">
                                                <tr>
                                                    <td>{!Ap.User__r.Name}</td>
                                                    <td>{!Ap.Sequence_Position__c}</td>
                                                    <td>{!Ap.Allowed_Days__c}</td>
                                                    <td>
                                                        <apex:outputText value="{0,date,dd MMM yyyy}">
                                                            <apex:param value="{!Ap.Due_Date__c}" /> 
                                                        </apex:outputText>                                  
                                                    </td>
                                                    <td><apex:outputText value="{!Ap.Status__c}" rendered="{!documentProfile.Status__c!='Open'}"></apex:outputText> </td>
                                                    <td>
                                                        <apex:outputText rendered="{!documentProfile.Status__c!='Open'}" value="{0,date,dd MMM yyyy}">
                                                            <apex:param value="{!Ap.Status_Updated__c}" /> 
                                                        </apex:outputText>                                      
                                                    </td>
                                                </tr>                                
                                            </apex:repeat>
                                            
                                        </tbody>
                                    </table>
                                </apex:outputPanel>
                                
                                <div class="print-only">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingOne">
                                            <div> <h4 class="panel-title"><h1>  Reference &nbsp; </h1>
                                                </h4>
                                            </div>
                                            <div class="panel-body">
                                                <h2>NC</h2>
                                                <table class="table table-hover table-condensed">
                                                    <tbody>
                                                        <tr>
                                                            <th>{!$ObjectType.Non_Conformance__c.Fields.Name.Label}</th>
                                                            <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Type__c.Label}</th>
                                                            <th>{!SUBSTITUTE($ObjectType.Non_Conformance__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                            <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Source__c.Label}</th>
                                                            <th>{!$ObjectType.Non_Conformance__c.Fields.NC_Status__c.Label}</th>
                                                            <th></th>
                                                        </tr>
                                                        <apex:repeat value="{!nonConf}" var="ncon">
                                                            <tr id="{!JSENCODE(ncon.id)}">
                                                                <td><a href='/{!JSENCODE(ncon.Non_Conformance__c)}'><apex:outputtext value="{!ncon.Non_Conformance__r.Name}"/></a></td>
                                                                <td><apex:outputtext value="{!ncon.NC_Type__c}"/></td>
                                                                <td><apex:outputtext value="{!ncon.Owner__c}"/></td>
                                                                <td><apex:outputtext value="{!ncon.Source__c}"/></td>
                                                                <td><apex:outputtext value="{!ncon.Status__c}"/></td>
                                                                <td><i class="fa fa-remove" onclick="removeRow('{!JSENCODE(ncon.id)}');"></i></td>
                                                            </tr>
                                                            
                                                        </apex:repeat>
                                                        
                                                    </tbody>
                                                </table>
                                                
                                                <h2>CAPA</h2>
                                                <table class="table table-hover table-condensed">
                                                    <tbody>
                                                        <tr>
                                                            <th>{!$ObjectType.CAPA__c.Fields.Name.Label}</th>
                                                            <th>{!$ObjectType.CAPA__c.Fields.Title__c.Label}</th>
                                                            <th>{!SUBSTITUTE($ObjectType.CAPA__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                            <th>{!$ObjectType.CAPA__c.Fields.CAPA_Source__c.Label}</th>
                                                            <th>{!$ObjectType.CAPA__c.Fields.CAPA_Status__c.Label}</th>
                                                            <th></th>
                                                        </tr>
                                                        <apex:repeat value="{!capaList}" var="capa">
                                                            <tr id="{!JSENCODE(capa.id)}">
                                                                <td><a href='/{!JSENCODE(capa.CAPA__c)}'><apex:outputtext value="{!capa.CAPA__r.Name}"/></a></td>
                                                                <td><apex:outputtext value="{!capa.Title__c}"/></td>
                                                                <td><apex:outputtext value="{!capa.Owner__c}"/></td>
                                                                <td><apex:outputtext value="{!capa.Source__c}"/></td>
                                                                <td><apex:outputtext value="{!capa.Status__c}"/></td>
                                                                <td><i class="fa fa-remove" onclick="removeRow('{!JSENCODE(capa.id)}');"></i></td>
                                                            </tr>
                                                            
                                                        </apex:repeat> 
                                                        
                                                    </tbody>
                                                </table>
                                                
                                                <h2>Documents</h2>
                                                <table class="table table-hover table-condensed">
                                                    <tbody>
                                                        <tr>
                                                            <th>{!$ObjectType.Document_Profile__c.Fields.Name.Label}</th>
                                                            <th>{!$ObjectType.Document_Profile__c.Fields.Current_Rev__c.Label}</th>
                                                            <th>{!$ObjectType.Document_Profile__c.Fields.Relation__c.Label}</th>
                                                            <th>{!SUBSTITUTE($ObjectType.Document_Profile__c.Fields.OwnerId.Label, 'ID', '')}</th>
                                                            <th>{!$ObjectType.Document_Profile__c.Fields.Status__c.Label}</th>
                                                            <th></th>
                                                        </tr>
                                                        <apex:repeat value="{!docList}" var="doc">
                                                            <tr id="{!JSENCODE(doc.id)}">
                                                                <td><a href='/{!JSENCODE(if(doc.DocumentChild__c!=dmid,doc.DocumentChild__c,doc.DocumentParent__c))}'><apex:outputtext value="{!if(doc.DocumentChild__c!=dmid,doc.DocumentChild__r.Name,doc.DocumentParent__r.Name)}"/></a></td>
                                                                <td><apex:outputtext value="{!doc.Current_Rev__c}"/></td>
                                                                <td><apex:outputtext value="{!if(doc.DocumentChild__c!=dmid,doc.RelationWithParent__c,doc.RelationWithChild__c)}"/></td>
                                                                <td><apex:outputtext value="{!doc.Owner__c}"/></td>
                                                                <td><apex:outputtext value="{!doc.Status__c}"/></td>
                                                                <td><i class="fa fa-remove" onclick="removeRow('{!JSENCODE(doc.id)}');"></i></td>
                                                            </tr>
                                                        </apex:repeat>
                                                        
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-------------------------Tasks--------------------->
                                <div class="print-only">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingOne">
                                            <h4 class="panel-title">Collaboration Review 
                                            </h4>
                                            
                                            <apex:repeat value="{!collRevHistory}" var="col">
                                                
                                                <!-- multi panel starts -->
                                                
                                                
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">Review&nbsp;&nbsp; <apex:outputText value="{0,date,dd MMM yyyy}">
                                                        <apex:param value="{!rev1.review}" /> 
                                                        </apex:outputText> | Expire &nbsp;&nbsp;<apex:outputText value="{0,date,dd MMM yyyy}">
                                                        <apex:param value="{!rev1.dueDate}" /> 
                                                        </apex:outputText></div>
                                                    <div class="panel-body">                              
                                                        
                                                        <table class="table table-responsive table-bordered">                                      
                                                            <tbody>
                                                                <tr>
                                                                    <td colspan="3">
                                                                        <h4>{!$ObjectType.General_Task__c.Fields.Collaboration_Title__c.Label}</h4>
                                                                    </td>
                                                                    <td>{!collRevHistory[col].title}</td>
                                                                </tr>
                                                                
                                                                <tr>
                                                                    <td colspan="3">
                                                                        <h4> Primary File Location </h4>
                                                                    </td>
                                                                    <td>{!collRevHistory[col].primaryfilepath}</td>
                                                                </tr>
                                                                
                                                                <tr>
                                                                    <td colspan="3">
                                                                        <h4> {!$ObjectType.General_Task__c.Fields.Review_Description__c.label} </h4>
                                                                    </td>
                                                                    <td>{!collRevHistory[col].revDescription}</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        
                                                        <!--<apex:outputpanel rendered="{!collRevHistory[col].show}">-->
                                                        <div class="add-approver-row" id="Review1_div">
                                                            <table class="table table-bordered" id="Review_table_{!collRevHistory[col].incrementer}">
                                                                <thead>
                                                                    <tr>
                                                                        <td><span class="mandatory"><apex:outputtext value=""/></span>Reviewer Name</td>
                                                                        <td width="40%"><span class="mandatory"><apex:outputtext value=""/></span>Approval Date</td>
                                                                        <td width="20%"><span class="mandatory"><apex:outputtext value=""/></span>Status</td>
                                                                        
                                                                    </tr>
                                                                    <tr>
                                                                        <td>{!collRevHistory[col].Reviewer_Name}
                                                                        </td>
                                                                        <td>
                                                                            <apex:outputText value="{0,date,dd MMM yyyy}">
                                                                                <apex:param value="{!collRevHistory[col].Approval_Date}" /> 
                                                                            </apex:outputText>
                                                                        </td>
                                                                        <td>{!collRevHistory[col].status}
                                                                            
                                                                            
                                                                            
                                                                            
                                                                        </td>
                                                                    </tr>
                                                                </thead>
                                                                
                                                                <tbody>
                                                                    <tr class="" id="row_1">
                                                                        
                                                                        
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            
                                                        </div>
                                                        <!-- </apex:outputpanel>-->
                                                    </div>
                                                    
                                                    
                                                    
                                                </div>   
                                            </apex:repeat>   
                                        </div>
                                    </div>
                                </div>
                                <div class="print-only">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingOne">
                                            <h4 class="panel-title">Effectiveness Review 
                                            </h4>
                                            <div>
                                                
                                            
                                 <apex:repeat value="{!EffRevHistory}" var="actionPlan">
                                    
                                    <!-- multi panel starts -->
                                    <div class="panel panel-default">
                                        <div class="panel-heading">Review&nbsp;&nbsp; <apex:outputText value="{0,date,dd MMM yyyy}">
                                            <apex:param value="{!rev1.review}" /> 
                                            </apex:outputText> | Expire &nbsp;&nbsp;<apex:outputText value="{0,date,dd MMM yyyy}">
                                            <apex:param value="{!rev1.dueDate}" /> 
                                            </apex:outputText></div>
                                        <div class="panel-body">                              
                                            <table class="table table-responsive table-bordered">                                      
                                                <tbody>
                                                    <tr>
                                                        <td colspan="3">
                                                            <h4>{!$ObjectType.General_Task__c.Fields.Owner__c.Label}</h4>{!EffRevHistory[actionPlan].owner}
                                                        </td>
                                                        <td colspan="3">
                                                            <h4>{!$ObjectType.General_Task__c.Fields.Due_Date__c.Label}</h4>
                                                            <apex:outputText value="{0,date,dd MMM yyyy}">
                                                                <apex:param value="{!EffRevHistory[actionPlan].dueDate}" /> 
                                                            </apex:outputText>
                                                        </td>
                                                        
                                                    </tr>
                                                    
                                                     <tr>
                                                        <td colspan="3">
                                                            <h4>{!$ObjectType.General_Task__c.Fields.Document_Status__c.Label}</h4>{!EffRevHistory[actionPlan].documentStatus}
                                                        </td>
                                                         
                                                         <td colspan="3"> 
                                                            <h4>{!$ObjectType.Document_Profile__c.Fields.New_Expiration_Date__c.label}</h4> 
                                                            <apex:outputText value="{0,date,dd MMM yyyy}">
                                                                <apex:param value="{!EffRevHistory[actionPlan].newExpirationDate}" /> 
                                                            </apex:outputText>
                                                        </td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td colspan="10">
                                                            <h4>{!$ObjectType.General_Task__c.Fields.Review_Description__c.Label}</h4> 
                                                            <p>
                                                                {!EffRevHistory[actionPlan].revDescription}
                                                            </p>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <apex:outputpanel rendered="{!EffRevHistory[actionPlan].show}">
                                                <div class="add-approver-row " id="Review1_div">
                                                    <table class="table table-bordered " id="Review_table_{!EffRevHistory[actionPlan].incrementer}">
                                                        <thead>
                                                            <tr>
                                                                <td><span class="mandatory"><apex:outputtext value=""/></span>Reviewer Name</td>
                                                                <td width="40%"><span class="mandatory"><apex:outputtext value=""/></span>Approval Date</td>
                                                                <td width="20%"><span class="mandatory"><apex:outputtext value=""/></span>Status</td>
                                                                
                                                            </tr>
                                                            <tr>
                                                                <td>{!EffRevHistory[actionPlan].Reviewer_Name}
                                                                </td>
                                                                <td>
                                                                    <apex:outputText value="{0,date,dd MMM yyyy}">
                                                                        <apex:param value="{!EffRevHistory[actionPlan].Approval_Date}" /> 
                                                                    </apex:outputText>
                                                                </td>
                                                                <td>{!EffRevHistory[actionPlan].status}
                                                                </td>
                                                            </tr>
                                                        </thead>
                                                        
                                                        <tbody>
                                                            <tr class="" id="row_1">
                                                                
                                                                
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </apex:outputpanel>               
                                            
                                        </div>
                                        
                                        
                                        
                                    </div>   
                                </apex:repeat>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!---------------------------------------------------->
                            </div>  
                        </div>
                        
                    </div>
                </div>
            </div>
        </body>
    </html>
    
    </apex:outputPanel>
    
    <!----------------------------v1.5 end----------------------------------------------->
       <!-- Modal Document  History (Start)-->
<div class="modal fade" id="doc_history" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Document  History</h4>
      </div>
      <div class="modal-body" style="overflow:auto; min-height: 100px; max-height: 300px ">
        <table id="contentVersionTable" class="table table-bordered">
            <thead>
                          <tr>
                            <th>Document Number</th>
                            <th>Revision</th>
                            <th>Status</th> 
                            <th>Effective Date</th>
                            <th>Expiration Date</th>
                           </tr>
                        </thead>
                                          
                        
                        <tbody id="contentVersionList">
                            <apex:repeat value="{!documentReviseHistoryList1}" var="drh">
                                
                                <tr>
                                   <apex:outputPanel rendered="{!drh.Enable_Security__c}">  
                                    <td id="{!JSENCODE(drh.Id)}">{!JSENCODE(drh.Name)}</td>
                                    </apex:outputPanel>
                                     <apex:outputPanel rendered="{!NOT(drh.Enable_Security__c)}">
                                        <apex:outputPanel rendered="{!drh.Status__c=='Current'}">
                                            <td > <a target="_blank" href="/apex/DocumentProfile?id={!JSENCODE(drh.Id)}&pg=doc_Details" class="btn-link" onclick="">
                                                {!JSENCODE(drh.Name)}</a></td>
                                        </apex:outputPanel> 
                                        <apex:outputPanel rendered="{!NOT(drh.Status__c=='Current')}">
                                            <td>{!JSENCODE(drh.Name)}</td>
                                        </apex:outputPanel>
                                    </apex:outputPanel>
                                    <td>{!JSENCODE(drh.Current_Rev__c)}</td>
                                    <td>{!JSENCODE(drh.Status__c)}</td>
                                    <td><apex:outputField value="{!drh.Effective_Date__c}"></apex:outputField></td>
                                    <td><apex:outputField value="{!drh.Expiration_Date__c}"></apex:outputField></td>
                                </tr>
                                
                            </apex:repeat>
                             
                            
                        </tbody>
 
        </table>
      </div>
       <apex:outputPanel rendered="{!OR(NOT(ISBLANK($CurrentPage.parameters.doctypeId)))}"> 
           <!-- <apex:repeat value="{!documentTypeCreate}" var="doctyp">-->
    
               <script type="text/javascript">
                  $(document).ready(function() {
                     // var documentTypeName = '{!documentTypeCreate[0].Name}';
                      //console.log('document is herer'+documentTypeName);
                      /*
                      var itshere =  $('#Document_Type__c').attr('form-control  select2-hidden-accessible');
                      $('#Document_Type__c').append($('<option/>').val(documentTypeName).text(documentTypeName).attr('selected','selected'));
                      //alert($('#Document_Type__c').next().find('span').eq(0).attr('class'));
                      $('#Document_Type__c').next().find('span').eq(2).attr('title',documentTypeName);
                      $('#Document_Type__c').next().find('span').eq(2).text(documentTypeName);
                      console.log($("#select2-Document_Type__c-container").attr('id'));
                      */
                      //alert('{!$CurrentPage.parameters.doctypeId}');
                      if('{!$CurrentPage.parameters.doctypeId}'!=''){
                      //alert('aaaaa');
                       $('#{!IF(NOT(ISBLANK(Prefix)),Prefix+'__','')}Document_Type__c').html('<option selected="selected" value="' + '{!$CurrentPage.parameters.doctypeId}' + '">' + escapeHtml('{!$CurrentPage.parameters.docTitle}') + '</option>').trigger('change');
                      
                      }
                  });
                      
               </script>
           <!-- </apex:repeat>-->
       </apex:outputPanel>
        <script>
         $( document ).ready(function() {
        <apex:repeat value="{!documentReviseHistoryList}"  var="drh">
            $('#{!JSENCODE(drh.Id)}').html('<a target="_blank" href="/apex/DocumentProfile?id={!JSENCODE(drh.Id)}&pg=doc_Details" class="btn-link">{!JSENCODE(drh.Name)}</a>'); 
        </apex:repeat>
         }); 
        </script>
                     <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

 <!-- Modal Document  History (Stop)-->
</apex:page>